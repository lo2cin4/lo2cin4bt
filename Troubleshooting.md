@ -1,485 +0,0 @@
# ⚠️ 疑難排解指南

本文件收集了用戶在使用 lo2cin4bt 時可能遇到的常見問題與解決方案。
如遇到其他問題，歡迎到 [TG討論社群](https://t.me/lo2cin4group) 或 [DC討論社群](https://discord.com/invite/6HgJC2dUvg) 提出。

---

## ✅ 下載與安裝

### **安裝依賴時出現 'SyntaxError: Missing parentheses in call to 'print''**

安裝依賴套件時可能出現以下錯誤：
```
SyntaxError: Missing parentheses in call to 'print'. Did you mean print(...)?
note: This error originates from a subprocess, and is likely not a problem with pip.
```

**原因：**
這是 Python 2/3 兼容性問題，通常發生在某些依賴包（如 `numba`、`llvmlite`）的舊版本在安裝時執行了 Python 2 風格的代碼。

**解決方案：**

1. **確保使用 Python 3.9 或更高版本**
   ```bash
   python --version  # 應顯示 Python 3.9.x 或更高
   ```

2. **升級 pip、setuptools 和 wheel**
   ```bash
   python -m pip install --upgrade pip setuptools wheel
   ```

3. **單獨安裝可能有問題的包（指定較新版本）**
   ```bash
   pip install numba>=0.58.0 llvmlite>=0.41.0
   ```

4. **然後再安裝其他依賴**
   ```bash
   pip install -r requirements.txt
   ```

5. **如果問題仍然存在，嘗試使用虛擬環境**
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate
   pip install --upgrade pip setuptools wheel
   pip install -r requirements.txt
   
   # macOS/Linux
   python3 -m venv venv
   source venv/bin/activate
   pip install --upgrade pip setuptools wheel
   pip install -r requirements.txt
   ```

---

## ✅ 主選單

（目前無用戶使用問題，如有問題歡迎回報）

---

## ✅ 載入數據

### **API 連接失敗**

**問題詳情：** 無法連接 Binance 或 Coinbase API，顯示連接超時或 HTTP 錯誤。

**可能原因：**
- 網路連線問題
- API 服務暫時無法使用
- 防火牆或代理設定阻擋連線

**解決方法：**
- 檢查網路連線
- 確認 API 服務狀態（查看官方狀態頁面）
- 若使用代理，確認代理設定正確
- 改用其他數據來源（Yahoo Finance 或本地檔案）

---

### **欄位名稱不一致**

**問題詳情：** 載入檔案後，下游模組報錯「找不到 Open 欄位」。

**可能原因：**
- 本地檔案欄位名稱未使用標準格式（Time, Open, High, Low, Close, Volume）
- 欄位名稱包含額外空格或特殊字元

**解決方法：**
- 使用 `FileLoader` 時，系統會自動標準化常見欄位名稱
- 若自動標準化失敗，請手動修改檔案欄位名稱為標準格式
- 確保欄位名稱首字母大寫（Time, Open, High, Low, Close, Volume）

---

### **時間格式無法識別**

**問題詳情：** 載入預測因子時，顯示「時間格式轉換失敗」或大量時間值無效。

**可能原因：**
- 時間欄位格式不標準（如 31-12-2000 vs 2000-12-31）
- 時間欄位包含非時間資料
- Excel 日期被誤讀為數值

**解決方法：**
- 建議使用標準 ISO 8601 格式：YYYY-MM-DD（如 2023-01-01）
- 在 `PredictorLoader` 提示時，輸入正確的時間格式（如 %d-%m-%Y 表示 31-12-2000）
- 在 Excel 中確認時間欄位格式為「日期」而非「一般」或「數值」
- 導出 CSV 前先在 Excel 中將時間欄位格式化為文字

---

### **預測因子合併後數據為空**

**問題詳情：** 載入預測因子並與價格數據合併後，回傳空 DataFrame。

**可能原因：**
- 價格數據與預測因子的時間範圍無交集
- 時間格式不一致（如價格用日期，預測因子用時間戳）
- 時區差異導致時間無法對齊

**解決方法：**
- 確認兩份數據的時間範圍有重疊
- 統一時間格式（都使用日期或都使用時間戳）
- 在合併前檢視兩份數據的時間範圍：
```python
print(f"價格數據時間範圍：{price_data['Time'].min()} ~ {price_data['Time'].max()}")
print(f"預測因子時間範圍：{predictor_data['Time'].min()} ~ {predictor_data['Time'].max()}")
```

---

### **缺失值處理後仍有 NaN**

**問題詳情：** 經過 `DataValidator` 處理後，數據仍包含 NaN 值。

**可能原因：**
- 某些欄位所有值都是 NaN，無法填充
- 選擇的填充方式不適合該欄位（如選擇前向填充但第一個值就是 NaN）

**解決方法：**
- 檢查原始數據，確認欄位是否有有效值
- 針對第一個值為 NaN 的情況，選擇「固定值填充」（選項 C,0）
- 若整個欄位都是 NaN，考慮移除該欄位或從數據源重新載入

---

### **導出檔案時權限錯誤**

**問題詳情：** 嘗試導出數據時顯示 `PermissionError`。

**可能原因：**
- 目標檔案正被其他程式開啟（如 Excel）
- 對目標目錄沒有寫入權限
- 檔案被標記為唯讀

**解決方法：**
- 關閉所有開啟該檔案的程式
- 確認對 `records/dataloader/` 目錄有寫入權限
- 若檔案為唯讀，移除唯讀屬性
- 嘗試使用不同的檔案名稱

---

### **Timestamp格式無法識別**

**問題詳情：** 載入含有timestamp的檔案時，時間欄位無法被正確識別或轉換。

**可能原因：**
- Timestamp數值超出合理範圍（如使用微秒級timestamp）
- Timestamp欄位被儲存為字符串而非數值
- Timestamp為負數或其他特殊值

**解決方法：**
- 確認timestamp為正整數（秒級約10位數，毫秒級約13位數）
- 若timestamp為字符串，確保檔案中沒有引號包圍數值
- 使用以下Python代碼驗證timestamp範圍：
```python
import pandas as pd
# 檢查timestamp是否在合理範圍
timestamp = 1609459200  # 你的timestamp
print(pd.to_datetime(timestamp, unit='s'))  # 秒級
print(pd.to_datetime(timestamp * 1000, unit='ms'))  # 毫秒級
```
- 若仍無法自動轉換，可在Excel或Python中預先將timestamp轉換為標準日期格式再導入

---

### **差分處理後數據異常**

**問題詳情：** 差分處理後，數值出現極端值或全為 NaN。

**可能原因：**
- 原始數據包含異常值（如突然的跳空或資料錯誤）
- 原始數據中有大量連續的相同值
- 選擇除數差分但數據包含 0 值

**解決方法：**
- 在差分前先檢查原始數據是否有異常：
```python
print(data[predictor_col].describe())
print(data[predictor_col].value_counts())
```
- 若數據包含 0 值，系統會自動限制只能使用減數差分
- 考慮先對原始數據進行異常值處理（如設定上下限）

---

## ✅ 統計分析

（目前無用戶使用問題，如有問題歡迎回報）

---

## ✅ 回測交易

### **回測後程序無法讀取 Parquet file**

**問題詳情：** 回測完成後，系統無法讀取產生的 Parquet 檔案。

**可能原因：**
- Parquet 檔案格式損壞
- 檔案被其他程式佔用
- 檔案路徑錯誤

**解決方法：**
- 確認 Parquet 檔案存在於 `records/backtester/` 目錄
- 關閉可能佔用檔案的程式（如 Excel）
- 檢查檔案是否完整（可使用 `records/Read_parquet.py` 查看）
- 若檔案損壞，重新執行回測

---

## ✅ 交易分析

（目前無用戶使用問題，如有問題歡迎回報）

---

## ✅ 可視化平台

### **Dash 應用無法啟動**

**問題詳情：** 選擇可視化平台後，無法啟動 Dash 應用或顯示端口錯誤。

**可能原因：**
- 端口被佔用（預設 8050）
- 依賴套件未安裝
- 防火牆設置阻擋

**解決方法：**
- 檢查端口是否被佔用，關閉佔用端口的程式
- 確認已安裝所有依賴套件：`pip install -r requirements.txt`
- 檢查防火牆設置，允許 Python 訪問網路
- 嘗試使用其他端口（修改 `Base_plotter.py` 中的 port 參數）

---

### **圖表無法顯示**

**問題詳情：** Dash 應用啟動成功，但圖表區域為空白或無法顯示數據。

**可能原因：**
- 數據格式不正確
- Plotly 版本不兼容
- 瀏覽器控制台有錯誤

**解決方法：**
- 檢查數據格式是否正確（確認 `records/metricstracker/` 目錄下有 Parquet 檔案）
- 確認 Plotly 版本兼容性：`pip install plotly>=5.0.0`
- 打開瀏覽器開發者工具（F12），查看控制台錯誤訊息
- 確認 Parquet 檔案包含必要的欄位（Time, Equity_value 等）

---

### **回調函數無響應**

**問題詳情：** 點擊控制面板的選項時，圖表沒有更新或無反應。

**可能原因：**
- 回調函數命名錯誤
- 輸入輸出組件 ID 不匹配
- 數據類型不匹配

**解決方法：**
- 重新啟動 Dash 應用
- 檢查瀏覽器控制台是否有 JavaScript 錯誤
- 確認 Parquet 檔案格式正確，包含必要的 metadata
- 查看 Dash 應用日誌，確認是否有錯誤訊息

---

### **參數高原功能異常**

**問題詳情：** 參數高原控制面板的滑動條無法正常拖動或數值顯示錯誤。

**可能原因：**
- 參數值類型轉換錯誤
- 滑動條數值範圍設置不正確
- 參數固定狀態管理異常

**解決方法：**
- 確認策略參數格式正確（範圍格式如 "10:20:10"）
- 重新載入數據
- 檢查 Parquet 檔案的 metadata 是否包含完整的參數信息
- 若問題持續，嘗試使用其他策略或參數組合

---

### **可視化介面鎖定問題**

**問題詳情：** 在長時間未重啟電腦的情況下，多次使用可視化平台測試不同檔案後，可視化介面會鎖定在最後一次載入的專案狀態，無法切換或更新到其他專案。

**解決方法：**
- **重啟電腦**：這是最直接有效的解決方法，可以清除所有累積的狀態和快取

---

## ✅ 自動化回測

### **配置文件載入失敗**

**問題詳情：** 選擇配置文件後顯示「JSON 格式錯誤」或「編碼錯誤」。

**可能原因：**
- JSON 格式不正確（缺少逗號、括號不匹配等）
- 文件編碼不是 UTF-8
- 文件包含 BOM（Byte Order Mark）

**解決方法：**
- 使用 JSON validator 檢查格式（如 [jsonlint.com](https://jsonlint.com/)）
- 確認文件編碼為 UTF-8（不含 BOM）
- 檢查是否有中文引號（""）應改為英文引號（""）
- 從 `templates/` 目錄複製模板重新編輯

---

### **配置驗證失敗**

**問題詳情：** 配置文件驗證時顯示「缺少必要欄位」或「參數格式錯誤」。

**可能原因：**
- 缺少必要的配置區塊（dataloader、backtester）
- 指標參數格式不正確
- 數據源配置不完整

**解決方法：**
- 對照 `config_template.json` 檢查是否缺少必要欄位
- 確認指標參數使用範圍格式：`"10:100:10"`（起始:結束:步長）
- 確認選擇的數據源有對應的配置區塊（如選擇 binance 需要 binance_config）
- 檢查錯誤信息中指出的具體缺失欄位

---

### **Timestamp 無法正確轉換**

**問題詳情：** 預測因子包含 timestamp，但載入後時間範圍錯誤或無法與價格數據對齊。

**可能原因：**
- `time_format` 設定錯誤（應該留空但填了格式）
- Timestamp 數值超出合理範圍
- Timestamp 被讀取為字符串而非數值

**解決方法：**
- **如果是 Unix timestamp（純數字）**：`"time_format": ""` 必須留空
- 確認 timestamp 範圍合理：
  - 秒級：約 10 位數（1000000000 ~ 2000000000）
  - 毫秒級：約 13 位數（1000000000000 ~ 2000000000000）
- 檢查 CSV 文件中 timestamp 欄位是否有引號包圍（應該沒有）
- 查看調試信息中的「檢測 timestamp」面板，確認數值類型

---

### **數據載入後無法合併**

**問題詳情：** 顯示「價格數據與預測因子數據無時間交集，無法合併」。

**可能原因：**
- 時間範圍沒有重疊
- 時間精度不同（價格精確到秒，預測因子只有日期）
- 時區問題

**解決方法：**
- 查看「時間對齊診斷」面板，對比兩邊的時間範圍
- 確認兩邊的時間範圍有重疊
- 如果精度不同，需要統一精度（都使用日期或都精確到秒）
- 檢查 timestamp 轉換是否成功（應該看到「timestamp轉換成功」提示）

---

### **回測無交易或交易數量異常**

**問題詳情：** 回測完成但顯示「無交易」或交易數量與預期不符。

**可能原因：**
- 指標參數範圍不合理（如 MA 週期過長）
- 策略條件配對錯誤
- 預測因子欄位名稱錯誤
- 數據質量問題（缺失值、異常值過多）

**解決方法：**
- 檢查指標參數範圍是否合理（MA 週期不應超過數據長度的1/3）
- 確認 `selected_predictor` 欄位名稱與數據中的欄位一致
- 檢查策略條件配對邏輯是否正確
- 先用較寬鬆的參數範圍測試（如 MA 10:50:10）
- 查看數據預覽，確認數據質量正常

---

### **配置文件中有多個時間欄位**

**問題詳情：** CSV 文件包含多個時間相關欄位（如 `timestamp`、`timestamp.1`、`Time`），導致載入失敗。

**可能原因：**
- CSV 文件匯出時產生重複欄位
- Excel 轉 CSV 時欄位名稱衝突

**解決方法：**
- 系統會自動選擇優先順序最高的欄位（timestamp > datetime > date > time > period）
- 自動排除帶有數字後綴的重複欄位（如 `timestamp.1`、`time_2`）
- 如果仍有問題，在 CSV 中手動刪除重複的時間欄位，只保留一個
- 在 `predictor_config` 中明確指定要使用的時間欄位：`"time_column": "timestamp"`

---

### **績效分析失敗或結果不完整**

**問題詳情：** MetricsRunner 執行失敗或分析結果缺失某些指標。

**可能原因：**
- Parquet 文件不存在或格式錯誤
- 回測記錄缺少必要欄位
- 無風險利率或時間單位設定錯誤

**解決方法：**
- 確認 `records/backtester/` 目錄下有 Parquet 文件
- 檢查 Parquet 文件是否完整（使用 `records/Read_parquet.py` 查看）
- 確認 `risk_free_rate` 格式正確（0.04 表示 4%）
- 確認 `time_unit` 設定正確（日線股票 252，日線幣 365）
- 查看 MetricsRunner 的錯誤信息，根據提示修正

---

### **多配置執行時部分失敗**

**問題詳情：** 批次執行多個配置時，某些配置成功，某些失敗。

**可能原因：**
- 某些配置文件格式有誤
- 某些數據源無法連接（如 API 限制）
- 資源不足（記憶體、磁碟空間）

**解決方法：**
- 查看執行摘要，找出失敗的配置文件
- 單獨運行失敗的配置，查看詳細錯誤信息
- 檢查網路連接（對於 API 數據源）
- 確認有足夠的磁碟空間儲存結果
- 考慮分批執行，減少同時處理的配置數量

---

### **參數組合數量異常**

**問題詳情：** 顯示的參數組合數量與預期不符（如預期 16 個卻顯示 80 個）。

**可能原因：**
- 指標參數轉換邏輯錯誤
- 策略配對複製錯誤
- 參數範圍解析錯誤

**解決方法：**
- 確認每個指標的參數範圍格式是否正確（如 "10:50:10"）
- 檢查 `condition_pairs` 數量與預期一致
- 查看調試輸出中的「參數組合數量」信息
- 對照配置模板檢查參數設定是否正確

---

## 📞 需要更多幫助？

如果以上解決方案無法解決您的問題，歡迎：

- 到 [TG討論社群](https://t.me/lo2cin4group) 提問
- 到 [DC討論社群](https://discord.com/invite/6HgJC2dUvg) 提問
- 聯繫 Telegram: [@lo2cin4_jesse](https://t.me/lo2cin4_jesse)

---

**最後更新：** 2025-11-23
