# metricstracker é–‹ç™¼è€…èªªæ˜æ–‡ä»¶

## æ¨¡çµ„æ¦‚è¦½ï¼ˆModule Overviewï¼‰

**metricstracker** æ˜¯ lo2cin4BT é‡åŒ–å›æ¸¬æ¡†æ¶ä¸­çš„ç¨ç«‹ç¸¾æ•ˆåˆ†ææ¨¡çµ„ï¼Œè² è²¬å›æ¸¬çµæœçš„ç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—èˆ‡æ¨™æº–åŒ–è³‡æ–™ç®¡ç†ã€‚
æœ¬æ¨¡çµ„åƒ…é€é DataFrame åŠ Parquet ç­‰æ¨™æº–æ ¼å¼èˆ‡å…¶ä»–æ¨¡çµ„äº¤äº’ï¼Œç¢ºä¿ä½è€¦åˆã€é«˜å¯ç¶­è­·æ€§ã€‚

- **è¼¸å…¥ä¾†æº**ï¼šå›æ¸¬ç”¢ç”Ÿçš„ Parquet æª”æ¡ˆï¼ˆå«äº¤æ˜“è¨˜éŒ„èˆ‡ metadataï¼‰
- **è¼¸å‡ºç›®æ¨™**ï¼šæ–°å¢ç¸¾æ•ˆæŒ‡æ¨™ metadata çš„ Parquet æª”æ¡ˆï¼Œä¾›å¾ŒçºŒåˆ†ææˆ–å‰ç«¯ä½¿ç”¨

---

## é–‹ç™¼ç›®æ¨™ï¼ˆDevelopment Goalsï¼‰

- è¨ˆç®—å’Œè¼¸å…¥æ¯æ—¥å›æ¸¬è¡¨ç¾æ•¸æ“šï¼Œå¦‚ï¼Œä¸¦å‰µå»ºæ–°çš„ parquet æª”æ¡ˆ
- æä¾›æ¨™æº–åŒ–çš„å›æ¸¬ç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—ï¼ˆå¦‚ç¸½å›å ±ã€å¹´åŒ–å›å ±ã€æœ€å¤§å›æ’¤ç­‰ï¼‰ï¼Œä¸¦è¼¸å…¥è‡³metadata å…§
- æ”¯æ´æ‰¹é‡å›æ¸¬çµæœçš„è‡ªå‹•åŒ¯å…¥ã€é¸æ“‡èˆ‡åˆ†æ
- åƒ…é€éæ¨™æº–æ ¼å¼ï¼ˆDataFrame/Parquetï¼‰èˆ‡å¤–éƒ¨æ¨¡çµ„æºé€š
- æ–¹ä¾¿æ“´å……æ¯æ—¥æŒ‡æ¨™ã€ç­–ç•¥æŒ‡æ¨™ç­‰å¤šå±¤æ¬¡ç¸¾æ•ˆåˆ†æ
- ä¿æŒæ¨¡çµ„åŒ–ã€ä½è€¦åˆã€æ˜“æ–¼å–®å…ƒæ¸¬è©¦èˆ‡ç¶­è­·

---

## å°ˆæ¡ˆçµæ§‹ï¼ˆProject Structureï¼‰

```plaintext
metricstracker/
â”œâ”€â”€ __init__.py                    # æ¨¡çµ„åˆå§‹åŒ–
â”œâ”€â”€ Base_metricstracker.py         # ç¸¾æ•ˆåˆ†æåŸºåº•é¡
â”œâ”€â”€ DataImporter_metricstracker.py # Parquet æª”æ¡ˆé¸æ“‡èˆ‡åŒ¯å…¥
â”œâ”€â”€ MetricsCalculator_metricstracker.py # æ ¸å¿ƒç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—å™¨
â”œâ”€â”€ README.md                      # æœ¬æ–‡ä»¶
```

- **Base_metricstracker.py**ï¼šå®šç¾©ç¸¾æ•ˆåˆ†æåŸºåº•é¡èˆ‡æ¨™æº–ä»‹é¢
- **DataImporter_metricstracker.py**ï¼šç”¨æˆ¶äº’å‹•å¼é¸æ“‡ã€åŒ¯å…¥ Parquet æª”æ¡ˆ
- **MetricsCalculator_metricstracker.py**ï¼šè¨ˆç®—å„é¡ç¸¾æ•ˆæŒ‡æ¨™ä¸¦å¯«å…¥ Parquet metadata

---

## æ ¸å¿ƒæ¨¡çµ„åŠŸèƒ½ï¼ˆCore Componentsï¼‰

### 1. Base_metricstracker.py

- **åŠŸèƒ½**ï¼šå®šç¾©ç¸¾æ•ˆåˆ†æçš„æ¨™æº–ä»‹é¢èˆ‡åŸºåº•é¡
- **ä¸»è¦è™•ç†**ï¼šè¦ç¯„ analyzeã€load_dataã€calculate_metricsã€export ç­‰æ–¹æ³•
- **è¼¸å…¥**ï¼šParquet æª”æ¡ˆè·¯å¾‘æˆ– DataFrame
- **è¼¸å‡º**ï¼šæ¨™æº–åŒ– DataFrame æˆ–åˆ†æçµæœ

### 2. DataImporter_metricstracker.py

- **åŠŸèƒ½**ï¼šäº’å‹•å¼åˆ—å‡ºã€é¸æ“‡å›æ¸¬ Parquet æª”æ¡ˆ
- **ä¸»è¦è™•ç†**ï¼šæƒææŒ‡å®šè³‡æ–™å¤¾ã€æ”¯æ´å¤šé¸/å…¨é¸ã€å›å‚³æª”æ¡ˆè·¯å¾‘
- **è¼¸å…¥**ï¼šç›®éŒ„è·¯å¾‘
- **è¼¸å‡º**ï¼šæ‰€é¸ Parquet æª”æ¡ˆè·¯å¾‘ list

### 3. MetricsCalculator_metricstracker.py

- **åŠŸèƒ½**ï¼šè¨ˆç®—å›æ¸¬ç¸¾æ•ˆæŒ‡æ¨™ï¼Œä¸¦å°‡çµæœå¯«å…¥ Parquet metadata
- **ä¸»è¦è™•ç†**ï¼šè‡ªå‹•åµæ¸¬å¹´æ•¸ï¼Œè¨ˆç®—ç¸½å›å ±ã€å¹´åŒ–å›å ±ã€CAGRã€æ¨™æº–å·®ã€æœ€å¤§å›æ’¤ç­‰ summary æŒ‡æ¨™
- **è¼¸å…¥**ï¼šå›æ¸¬ DataFrameã€æ™‚é–“å–®ä½ã€ç„¡é¢¨éšªåˆ©ç‡
- **è¼¸å‡º**ï¼šå«æŒ‡æ¨™ metadata çš„ Parquet æª”æ¡ˆ

---

## è¼¸å…¥è¼¸å‡ºè¦æ ¼ï¼ˆInput and Output Specificationsï¼‰

### è¼¸å…¥

- **ä¾†æº**ï¼š`records/backtester/` ç›®éŒ„ä¸‹çš„ Parquet æª”æ¡ˆ
- **é—œéµæ¬„ä½**ï¼š
  - `Time`ï¼ˆdatetimeï¼‰ï¼šäº¤æ˜“æ—¥æœŸ
  - `Equity_value`ï¼ˆfloatï¼‰ï¼šæ¯æ—¥è³‡ç”¢æ·¨å€¼
  - `Change`ï¼ˆfloatï¼‰ï¼šæ¯æ—¥å ±é…¬ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  - å…¶ä»–äº¤æ˜“è¨˜éŒ„æ¬„ä½
  - ç”¨æˆ¶è¼¸å…¥çš„æ™‚é–“å–®ä½ã€

### è¼¸å‡º

- **æ ¼å¼**ï¼šParquet æª”æ¡ˆï¼Œå­˜æ–¼ `records/metricstracker/`
- **å…§å®¹**ï¼š
  - DataFrameï¼šåŸå§‹äº¤æ˜“è¨˜éŒ„ï¼ˆå¯æ“´å……æ¯æ—¥æŒ‡æ¨™æ¬„ä½ï¼‰
  - Metadataï¼šæ–°å¢ `strategy_metrics1`ã€`bah_metrics1` ç­‰ç¸¾æ•ˆæŒ‡æ¨™ï¼ˆJSON å­—ä¸²ï¼‰

### æ¬„ä½æ˜ å°„ï¼ˆå¦‚éœ€ï¼‰

| è¼¸å…¥æ¬„ä½         | è¼¸å‡ºæ¬„ä½/ç”¨é€”         |
|------------------|----------------------|
| Time             | ç”¨æ–¼å¹´æ•¸è‡ªå‹•åµæ¸¬     |
| Change           | ç”¨æ–¼ç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—     |
| Equity_value     | ç”¨æ–¼å›å ±/å›æ’¤è¨ˆç®—    |

---

## ç¸¾æ•ˆæŒ‡æ¨™å®šç¾©ï¼ˆPerformance Metricsï¼‰

ï¼ˆä»¥ä¸‹æ–°å¢å„æŒ‡æ¨™å¸¸è¦‹æ•¸å€¼å€é–“èˆ‡è©•åƒ¹æ¨™æº–ï¼Œä¸¦èªªæ˜è² æ•¸æ„ç¾©ï¼‰

### 1. æ”¶ç›Šç›¸é—œæŒ‡æ¨™

- **ç¸½å›å ±ç‡ (Total_return)**ï¼šç­–ç•¥å¾é–‹å§‹åˆ°çµæŸçš„ç´¯è¨ˆå›å ±ç™¾åˆ†æ¯”ï¼Œåæ˜ æ•´é«”æ”¶ç›Šã€‚
  - å…¬å¼ï¼šTotal_return = (Equity_value.iloc[-1] / Equity_value.iloc[0]) - 1
  - **å¸¸è¦‹æ¨™æº–**ï¼š>0 ç‚ºæ­£å ±é…¬ï¼Œ<0 ç‚ºè™§æã€‚æ•¸å€¼æ„ˆé«˜æ„ˆå¥½ã€‚
- **è¤‡åˆå¹´å¢é•·ç‡ (Annualized_return(CAGR))**ï¼šè€ƒæ…®è¤‡åˆ©æ•ˆæ‡‰çš„å¹´åŒ–å›å ±ç‡ï¼Œè¡¡é‡é•·æœŸæ”¶ç›Šç©©å®šæ€§ã€‚
  - å…¬å¼ï¼šCAGR = [(Equity_value.iloc[-1] / Equity_value.iloc[0])^(1 / å¹´æ•¸) - 1]
  - **å¸¸è¦‹æ¨™æº–**ï¼š>10% ç‚ºåˆæ ¼ï¼Œ>20% ç‚ºè‰¯å¥½ï¼Œ>30% ç‚ºå„ªç§€ã€‚<0 ç‚ºé•·æœŸè™§æã€‚
- **æ¨™æº–å·® (Std)**ï¼šå›å ±åºåˆ—çš„æ¨™æº–å·®ï¼Œè¡¡é‡æ•´å€‹å›æ¸¬æœŸé–“æ”¶ç›Šæ³¢å‹•çš„æ•´é«”æ°´å¹³ã€‚
  - **å¸¸è¦‹æ¨™æº–**ï¼šç„¡çµ•å°æ¨™æº–ï¼Œéœ€èˆ‡å¹´åŒ–å ±é…¬ç‡æ­é…è§€å¯Ÿã€‚
- **å¹´åŒ–æ¨™æº–å·® (Annualized_std)**ï¼šå›å ±åºåˆ—çš„å¹´åŒ–æ¨™æº–å·®ï¼Œè¡¡é‡æ”¶ç›Šçš„å¹´åŒ–æ³¢å‹•ç¨‹åº¦ã€‚
  - å…¬å¼ï¼šStd Ã— å¹³æ–¹æ ¹(æ™‚é–“å–®ä½)
  - **å¸¸è¦‹æ¨™æº–**ï¼šæ„ˆä½æ„ˆç©©å®šï¼Œä½†éä½å¯èƒ½ä»£è¡¨ç­–ç•¥ä¸æ´»èºã€‚
- **ä¸‹è¡Œé¢¨éšª (Downside_risk)**ï¼šåƒ…è€ƒæ…®è² æ”¶ç›Šæˆ–ä½æ–¼ç›®æ¨™å›å ±çš„æ³¢å‹•æ€§ã€‚
  - **å¸¸è¦‹æ¨™æº–**ï¼šæ„ˆä½æ„ˆå¥½ã€‚
- **å¹´åŒ–ä¸‹è¡Œé¢¨éšª (Annualized_downside_risk)**ï¼šåƒ…è€ƒæ…®è² æ”¶ç›Šçš„å¹´åŒ–æ³¢å‹•æ€§ã€‚
  - å…¬å¼ï¼šDownside_risk Ã— å¹³æ–¹æ ¹(æ™‚é–“å–®ä½)
  - **å¸¸è¦‹æ¨™æº–**ï¼šæ„ˆä½æ„ˆå¥½ã€‚
- **æœ€å¤§å›æ’¤ç™¾åˆ†æ¯” (Max_drawdown)**ï¼šç­–ç•¥æ·¨å€¼å¾å³°å€¼åˆ°è°·åº•çš„æœ€å¤§è·Œå¹…ã€‚
  - å…¬å¼ï¼šmax((å³°å€¼ - è°·åº•) / å³°å€¼)
  - **å¸¸è¦‹æ¨™æº–**ï¼š>-10% æ¥µä½³ï¼Œ>-20% è‰¯å¥½ï¼Œ>-30% åˆæ ¼ï¼Œ<-30% é¢¨éšªåé«˜ã€‚
  - **è² æ•¸æ„ç¾©**ï¼šæ•¸å€¼è¶Šè² ä»£è¡¨æœ€å¤§æå¤±è¶Šå¤§ã€‚
- **å¹³å‡å›æ’¤ (Average_drawdown)**ï¼šå›æ’¤çš„å¹³å‡å¹…åº¦ã€‚
  - **å¸¸è¦‹æ¨™æº–**ï¼šæ„ˆæ¥è¿‘0æ„ˆå¥½ã€‚
- **æ¢å¾©å› å­ (Recovery_factor)**ï¼šç¸½å›å ±ç‡é™¤ä»¥æœ€å¤§å›æ’¤ç™¾åˆ†æ¯”ã€‚
  - å…¬å¼ï¼šRecovery_factor = Total_return / Max_drawdown
  - **å¸¸è¦‹æ¨™æº–**ï¼š>1 åˆæ ¼ï¼Œ>2 è‰¯å¥½ï¼Œ>3 å„ªç§€ã€‚è² æ•¸ä»£è¡¨é•·æœŸè™§æã€‚

### 2. é¢¨éšªèª¿æ•´å¾Œæ”¶ç›ŠæŒ‡æ¨™

#### å¹´åŒ–å¤æ™®æ¯”ç‡ (Sharpe)

- **å®šç¾©**ï¼šè¡¡é‡æ¯å–®ä½å¹´åŒ–æ³¢å‹•ç‡çš„è¶…é¡å›å ±ï¼Œæ¨™æº–åŒ–ç‚ºå¹´åŒ–å½¢å¼ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥åœ¨æ‰¿æ“”é¢¨éšªå¾Œçš„æ”¶ç›Šæ•ˆç‡ï¼Œå»£æ³›ç”¨æ–¼æ¯”è¼ƒä¸åŒç­–ç•¥ã€‚
- **å…¬å¼**ï¼š
  - Sharpe = (Mean_return - Risk_free_rate) / Std Ã— å¹³æ–¹æ ¹(å¹´åŒ–æ™‚é–“å–®ä½)
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <1 ä¸åˆæ ¼ï¼ˆé¢¨éšªå¤§æ–¼å ±é…¬ï¼‰
  - 1~2 åˆæ ¼
  - 2~2.5 è‰¯å¥½
  - â‰¥2.5 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨ç­–ç•¥é•·æœŸä¸‹ä¾†å ±é…¬ç‡ä½æ–¼ç„¡é¢¨éšªåˆ©ç‡ï¼Œæˆ–é¢¨éšªéå¤§ã€‚

#### ç´¢æè«¾æ¯”ç‡ (Sortino)

- **å®šç¾©**ï¼šé¡ä¼¼å¤æ™®æ¯”ç‡ï¼Œä½†åƒ…ç”¨ä¸‹è¡Œæ³¢å‹•ç‡è¨ˆç®—ï¼Œå°ˆæ³¨æ–¼ä¸åˆ©é¢¨éšªã€‚
- **å…¬å¼**ï¼š
  - Sortino = (Mean_return - Risk_free_rate) / Downside_risk Ã— å¹³æ–¹æ ¹(å¹´åŒ–æ™‚é–“å–®ä½)
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <1 ä¸åˆæ ¼
  - 1~2 åˆæ ¼
  - 2~2.5 è‰¯å¥½
  - â‰¥2.5 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨ä¸‹è¡Œé¢¨éšªéå¤§æˆ–å ±é…¬ç‡éä½ã€‚

#### å¡çˆ¾ç‘ªæ¯”ç‡ (Calmar)

- **å®šç¾©**ï¼šå¹´åŒ–å›å ±ç‡æ¸›å»ç„¡é¢¨éšªåˆ©ç‡å¾Œï¼Œå†é™¤ä»¥æœ€å¤§å›æ’¤ï¼Œè¡¡é‡è¶…é¡å›å ±ç›¸å°æœ€å¤§æå¤±çš„æ•ˆç‡ã€‚
- **å…¬å¼**ï¼š
  - Calmar = (Annualized_return - risk_free_rate) / abs(Max_drawdown)
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <0.5 ä¸åˆæ ¼
  - 0.5~1 åˆæ ¼
  - 1~2 è‰¯å¥½
  - â‰¥2 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨æœ€å¤§å›æ’¤éå¤§æˆ–å¹´åŒ–å ±é…¬ç‡ç‚ºè² ã€‚

#### ä¿¡æ¯æ¯”ç‡ (Information_ratio)

- **å®šç¾©**ï¼š(ç­–ç•¥å›å ± - åŸºæº–å›å ±)é™¤ä»¥è·Ÿè¸ªèª¤å·®ï¼Œè¡¡é‡ç›¸å°åŸºæº–çš„è¶…é¡å›å ±ç©©å®šæ€§ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥ç›¸å°æ–¼åŸºæº–ï¼ˆå¦‚æŒ‡æ•¸ï¼‰çš„è¡¨ç¾ã€‚
- **å…¬å¼**ï¼š
  Information_ratio = (Mean_return - BAH_Return.mean()) / (Return - BAH_Return).std()
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <0 ä¸åˆæ ¼
  - 0~0.5 åˆæ ¼
  - 0.5~1 è‰¯å¥½
  - â‰¥1 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨ç­–ç•¥é•·æœŸè¡¨ç¾ä¸å¦‚åŸºæº–ã€‚

#### Alpha

- **å®šç¾©**ï¼šç­–ç•¥ç›¸å°å¸‚å ´çš„è¶…é¡å›å ±ï¼ŒåŸºæ–¼CAPMæ¨¡å‹ã€‚
- **ç”¨é€”**ï¼šè¡¡é‡ç­–ç•¥å‰µé€ çš„ç¨ç«‹æ–¼å¸‚å ´çš„æ”¶ç›Šã€‚
- **å…¬å¼**ï¼š
  Alpha = Return.mean() - [Risk_free_rate + (cov(Return, BAH_Return) / var(BAH_Return)) * (BAH_Return.mean() - Risk_free_rate)]
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <0 ä¸åˆæ ¼
  - 0~0.05 åˆæ ¼
  - 0.05~0.1 è‰¯å¥½
  - â‰¥0.1 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨ç­–ç•¥é•·æœŸè¡¨ç¾ä¸å¦‚å¸‚å ´ã€‚

#### Beta

- **å®šç¾©**ï¼šè¡¡é‡ç­–ç•¥èˆ‡å¸‚å ´çš„ç›¸é—œæ€§å’Œç³»çµ±æ€§é¢¨éšªæ•å£ã€‚
- **ç”¨é€”**ï¼šåæ˜ ç­–ç•¥å°å¸‚å ´æ³¢å‹•çš„æ•æ„Ÿåº¦ã€‚
- **å…¬å¼**ï¼š
  Beta = cov(Return, BAH_Return) / var(BAH_Return)
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - 0~0.5 ä½ç›¸é—œ
  - 0.5~1.5 å¸‚å ´å‹
  - â‰¥1.5 é«˜é¢¨éšªå‹
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨èˆ‡å¸‚å ´å‘ˆåå‘é—œä¿‚ã€‚

### 3. äº¤æ˜“æ•ˆç‡æŒ‡æ¨™

#### äº¤æ˜“æ¬¡æ•¸ (Trade_count)

- **å®šç¾©**ï¼šåªè¨ˆç®—é–‹å€‰æ¬¡æ•¸ï¼Œä¸åŒ…æ‹¬å¹³å€‰ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥çš„äº¤æ˜“é »ç‡ã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼šä¾ç­–ç•¥è¨­è¨ˆè€Œç•°ï¼Œéé«˜å¯èƒ½ä»£è¡¨éåº¦äº¤æ˜“ã€‚

#### å‹ç‡ (Win_rate)

- **å®šç¾©**ï¼šç›ˆåˆ©äº¤æ˜“ä½”ç¸½äº¤æ˜“çš„æ¯”ä¾‹ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥çš„äº¤æ˜“æº–ç¢ºæ€§ï¼Œéœ€çµåˆç­–ç•¥è³ ç‡è§€å¯Ÿã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <0.3 å‹ç‡åä½
  - 0.3~0.5 åˆæ ¼
  - 0.5~0.7 è‰¯å¥½
  - â‰¥0.7 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šç„¡ï¼ˆå‹ç‡ä¸æœƒç‚ºè² ï¼‰ã€‚

#### ç›ˆè™§æ¯” (Profit_factor)

- **å®šç¾©**ï¼šç¸½ç›ˆåˆ©é™¤ä»¥ç¸½è™§æã€‚
- **ç”¨é€”**ï¼šåæ˜ ç­–ç•¥çš„æ•´é«”ç›ˆåˆ©æ•ˆç‡ã€‚
- **å…¬å¼**ï¼š
  Profit_factor = Trade_return[Trade_return > 0].sum() / abs(Trade_return[Trade_return < 0].sum())
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <1 ä¸åˆæ ¼ï¼ˆè³ å¤šè³ºå°‘ï¼‰
  - 1~1.5 åˆæ ¼
  - 1.5~2 è‰¯å¥½
  - â‰¥2 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šç†è«–ä¸Šä¸æœƒç‚ºè² ï¼Œè‹¥ç‚ºè² ä»£è¡¨è¨ˆç®—ç•°å¸¸ã€‚

#### å¹³å‡äº¤æ˜“å›å ± (Avg_trade_return)

- **å®šç¾©**ï¼šæ¯ç­†äº¤æ˜“çš„å¹³å‡æ”¶ç›Šã€‚
- **ç”¨é€”**ï¼šè¡¡é‡å–®ç­†äº¤æ˜“çš„æœŸæœ›æ”¶ç›Šã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼š>0 ç‚ºæ­£æœŸæœ›ï¼Œ<0 ç‚ºè² æœŸæœ›ã€‚

#### æœŸæœ›å€¼ (Expectancy)

- **å®šç¾©**ï¼šæ¯ç­†äº¤æ˜“çš„æœŸæœ›æ”¶ç›Šï¼Œè€ƒæ…®å‹ç‡èˆ‡ç›ˆè™§å¹…åº¦ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥çš„é•·æœŸç›ˆåˆ©æ½›åŠ›ã€‚
- **å…¬å¼**ï¼š
  Expectancy = (Win_rate Ã— å¹³å‡ç›ˆåˆ©) - (æ•—ç‡ Ã— abs(å¹³å‡è™§æ))
  æ•—ç‡ = 1 - å‹ç‡
- **å¸¸è¦‹æ¨™æº–**ï¼š
  - <0 ä¸åˆæ ¼ï¼ˆé•·æœŸä¸‹ä¾†æ¯åšä¸€ç­†äº¤æ˜“å¹³å‡æœƒè™§æï¼‰
  - 0~0.1 åˆæ ¼
  - 0.1~0.2 è‰¯å¥½
  - â‰¥0.2 å„ªç§€
- **è² æ•¸æ„ç¾©**ï¼šä»£è¡¨ç­–ç•¥é•·æœŸä¸‹ä¾†æ¯åšä¸€ç­†äº¤æ˜“å¹³å‡æœƒè™§æï¼Œé€šå¸¸æ˜¯å‹ç‡ä½æˆ–å¹³å‡è™§æé å¤§æ–¼å¹³å‡ç²åˆ©ã€‚

#### æœ€å¤§é€£çºŒè™§æ (Max_consecutive_losses)

- **å®šç¾©**ï¼šé€£çºŒè™§æäº¤æ˜“çš„æœ€å¤§æ¬¡æ•¸æˆ–é‡‘é¡ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°ç­–ç•¥åœ¨æœ€å·®æƒ…æ³ä¸‹çš„æŠ—å£“èƒ½åŠ›ã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼šä¾ç­–ç•¥è¨­è¨ˆè€Œç•°ï¼Œæ„ˆå°æ„ˆå¥½ã€‚
- **è² æ•¸æ„ç¾©**ï¼šç„¡ï¼ˆæ¬¡æ•¸ä¸æœƒç‚ºè² ï¼‰ã€‚

#### æŒå€‰æ™‚é–“æ¯”ä¾‹ (Exposure_time)

- **å®šç¾©**ï¼šæŒå€‰æ™‚é–“ä½”ç¸½æ™‚é–“çš„æ¯”ä¾‹ã€‚
- **ç”¨é€”**ï¼šè¡¡é‡è³‡é‡‘åœ¨å¸‚å ´ä¸­çš„æš´éœ²ç¨‹åº¦ã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼šä¾ç­–ç•¥è¨­è¨ˆè€Œç•°ã€‚

#### æœ€é•·æŒå€‰æ™‚é–“æ¯”ä¾‹ (Max_holding_period_ratio)

- **å®šç¾©**ï¼šå–®æ¬¡æŒå€‰æ™‚é–“çš„æœ€é•·æŒçºŒæ™‚é–“ä½”ç¸½å›æ¸¬æ™‚é–“çš„æ¯”ä¾‹ã€‚
- **ç”¨é€”**ï¼šè©•ä¼°å–®æ¬¡äº¤æ˜“çš„æœ€å¤§å¸‚å ´æš´éœ²æ™‚é–“ã€‚
- **å¸¸è¦‹æ¨™æº–**ï¼šä¾ç­–ç•¥è¨­è¨ˆè€Œç•°ã€‚

---

## ç›®å‰é€²åº¦ï¼ˆCurrent Progressï¼‰

### âœ… å·²å®Œæˆ

- Parquet æª”æ¡ˆå¤šé¸/å…¨é¸åŒ¯å…¥æµç¨‹
- å¹´æ•¸è‡ªå‹•åµæ¸¬ï¼ˆä¾æ“š Time æ¬„ä½ï¼‰
- æ¨™æº–åŒ–ç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—ä¸»é«”
- å°‡ä¸€äº›æ¯æ—¥æŒ‡æ¨™ï¼ˆå¦‚ drawdownã€B&H equity curveï¼‰è‡ªå‹•å¯«å…¥parquetçš„ä¸»è¡¨æ ¼å…§
- å¯«å…¥å¾Œoutputå‡º_metrics.parquet
- å®Œæ•´ä½è€¦åˆã€æ¨¡çµ„åŒ–è¨­è¨ˆ
- æ¯æ—¥æŒ‡æ¨™ï¼ˆå¦‚ drawdownã€B&H equity curveï¼‰å·²å®Œæ•´è‡ªå‹•å¯«å…¥ parquet ä¸»è¡¨æ ¼å…§

### ğŸ”„ é€²è¡Œä¸­

---

## ç–‘é›£æ’è§£ï¼ˆæŒçºŒæ›´æ–°ï¼‰

1. æ¯æ—¥æŒ‡æ¨™å°šæœªå¯«å…¥ DataFrame 22/07/2025
å•é¡Œè©³æƒ…ï¼šç›®å‰åƒ… summary æŒ‡æ¨™å¯«å…¥ metadataï¼ŒDataFrame æœªè‡ªå‹•æ–°å¢æ¯æ—¥æŒ‡æ¨™æ¬„ä½ã€‚
è§£æ±ºæ–¹æ³•ï¼šè¨­è¨ˆä¸­ï¼Œé è¨ˆæ”¯æ´ rolling/mdd ç­‰æ¯æ—¥æ¬„ä½ã€‚

2. pandas è®€å– Parquet ç„¡æ³•ç›´æ¥çœ‹åˆ° metadata 22/07/2025
å•é¡Œè©³æƒ…ï¼špandas è®€ parquet åªè¦‹ä¸»è¡¨ï¼Œmetadata éœ€ç”¨ pyarrow è®€å–ã€‚
è§£æ±ºæ–¹æ³•ï¼šå»ºè­°ç”¨ pyarrow æª¢æŸ¥æŒ‡æ¨™ã€‚

---

## é–‹ç™¼å·¥ä½œæµç¨‹ï¼ˆDevelopment Workflowï¼‰

### é‹è¡Œ/æ¸¬è©¦ç¯„ä¾‹

```bash
# äº’å‹•å¼é¸æ“‡æª”æ¡ˆä¸¦è¨ˆç®—æŒ‡æ¨™
python main.py
# æˆ–ç›´æ¥åŸ·è¡Œ DataImporter
python metricstracker/DataImporter_metricstracker.py
```

### è¼¸å‡ºè·¯å¾‘

- `records/metricstracker/xxx_metrics.parquet`ï¼šå«æŒ‡æ¨™ metadata çš„æ–°æª”æ¡ˆ

### ç’°å¢ƒéœ€æ±‚

- Python 3.9+
- ä¾è³´ï¼špandas, numpy, pyarrow

---

## æ¬„ä½å‘½åè¦ç¯„

- æ‰€æœ‰ä¸»è¡¨æ ¼æ¬„ä½ï¼Œç¬¬ä¸€å€‹å­—æ¯å¤§å¯«ï¼Œå…¶é¤˜å°å¯«ã€‚
- å…©å€‹å­—ä»¥ä¸Šçš„æ¬„ä½ç”¨ _é€£æ¥ï¼ˆå¦‚ Position_size, Trade_action, Equity_valueï¼‰ã€‚
- meta æ¬„ä½é¦–å­—æ¯å¤§å¯«ã€‚
- è«‹å…¨æµç¨‹ã€æ‰€æœ‰æ¨¡çµ„ã€æ‰€æœ‰å°å‡º/é©—è­‰/åˆ†æçš†éµå¾ªæ­¤è¦ç¯„ã€‚

---

## æŠ€è¡“å‚™è¨»ï¼ˆTechnical Notesï¼‰

- **æŒ‡æ¨™æ¬„ä½å®šç¾©**ï¼ˆsummaryï¼Œå¯«å…¥ metadataï¼‰ï¼š
  - total_return,annualized_return(cagr), std, annualized_std, downside_risk, annualized_downside_risk, max_drawdown, average_drawdown, recovery_factor, cov
- **è³‡æ–™å‹åˆ¥**ï¼š
  - `Time`ï¼šdatetime64[ns]
  - `Change`ã€`Equity_value`ï¼šfloat64
- **Parquet metadata**ï¼š
  - ä»¥ JSON å­—ä¸²å¯«å…¥ï¼Œkey ç‚º `strategy_metrics1`ã€`bah_metrics1` ç­‰

---

## è¯ç¹«æ–¹å¼ï¼ˆContactï¼‰

Telegram: [https://t.me/lo2cin4_jesse](https://t.me/lo2cin4_jesse)

---

å¦‚éœ€å”åŠ©æˆ–æœ‰å»ºè­°ï¼Œæ­¡è¿éš¨æ™‚è¯çµ¡ï¼

---

## Summary æŒ‡æ¨™å…¬å¼èˆ‡ä¸»è¡¨æ ¼æ¬„ä½å°ç…§è¡¨

| æŒ‡æ¨™åç¨±                | å…¬å¼ï¼ˆä»¥ä¸»è¡¨æ ¼æ¬„ä½è¡¨ç¤ºï¼‰                                                                 | éœ€ç”¨åˆ°çš„ä¸»è¡¨æ ¼æ¬„ä½         | ä¸»è¡¨æ ¼æ˜¯å¦å·²æœ‰æ¬„ä½ |
|------------------------|----------------------------------------------------------------------------------------|----------------------------|-------------------|
| ç¸½å›å ±ç‡ (Total_return) | (Equity_value.iloc[-1] / Equity_value.iloc[0]) - 1                                     | Equity_value               | âœ…                |
| BAH_ç¸½å›å ±ç‡ (BAH_Total_return) | (BAH_Equity.iloc[-1] / BAH_Equity.iloc[0]) - 1                                     | BAH_Equity               | âœ…                |
| è¤‡åˆå¹´å¢é•·ç‡ (Annualized_return(CAGR))     | pow(Equity_value.iloc[-1] / Equity_value.iloc[0], 1 / å¹´æ•¸) - 1                        | Equity_value               | âœ…                |
| BAH_è¤‡åˆå¹´å¢é•·ç‡ (BAH_Annualized_return(CAGR)) | pow(BAH_Equity.iloc[-1] / BAH_Equity.iloc[0], 1 / å¹´æ•¸) - 1                      | BAH_Equity               | âœ…                |
| æ¨™æº–å·® (Std)            | Return.std()                                                                           | Return                     | âœ…                |
| BAH_æ¨™æº–å·® (BAH_Std)            | BAH_Return.std()                                                                           | BAH_Return                     | âœ…                |
| å¹´åŒ–æ¨™æº–å·® (Annualized_std) | Return.std() * sqrt(æ™‚é–“å–®ä½)                                                        | Return                     | âœ…                |
| BAH_å¹´åŒ–æ¨™æº–å·® (BAH_Annualized_std) | BAH_Return.std() * sqrt(æ™‚é–“å–®ä½)                                                        | BAH_Return                     | âœ…                |
| ä¸‹è¡Œé¢¨éšª (Downside_risk)| Return[Return < 0] çš„æ¨™æº–å·®                                                            | Return                     | âœ…                |
| BAH_ä¸‹è¡Œé¢¨éšª (BAH_Downside_risk)| BAH_Return[BAH_Return < 0] çš„æ¨™æº–å·®                                                            | BAH_Return                     | âœ…                |
| å¹´åŒ–ä¸‹è¡Œé¢¨éšª (Annualized_downside_risk) | Downside_risk * sqrt(æ™‚é–“å–®ä½)                                              | Return                     | âœ…                |
| BAH_å¹´åŒ–ä¸‹è¡Œé¢¨éšª (BAH_Annualized_downside_risk) | BAH_Downside_risk * sqrt(æ™‚é–“å–®ä½)                                              | BAH_Return                     | âœ…                |
| æœ€å¤§å›æ’¤ (Max_drawdown) | (Equity_value - Equity_value.cummax()) / Equity_value.cummax() çš„æœ€å°å€¼                | Equity_value               | âœ…                |
| BAH_æœ€å¤§å›æ’¤ (BAH_Max_drawdown) | (BAH_Equity - BAH_Equity.cummax()) / BAH_Equity.cummax() çš„æœ€å°å€¼                | BAH_Equity, BAH_Drawdown               | âœ… |
| å¹³å‡å›æ’¤ (Average_drawdown) | (Equity_value - Equity_value.cummax()) / Equity_value.cummax() çš„å¹³å‡å€¼            | Equity_value               | âœ…                |
| BAH_å¹³å‡å›æ’¤ (BAH_Average_drawdown) | (BAH_Equity - BAH_Equity.cummax()) / BAH_Equity.cummax() çš„å¹³å‡å€¼            | BAH_Equity, BAH_Drawdown               | âœ… |
| æ¢å¾©å› å­ (Recovery_factor) | Total_return / abs(Max_drawdown)                                                      | Equity_value               | âœ…                |
| BAH_æ¢å¾©å› å­ (BAH_Recovery_factor) | BAH_Total_return / abs(BAH_Max_drawdown)                                                      | BAH_Equity, BAH_Drawdown               | âœ… |
| å¹´åŒ–å¤æ™®æ¯”ç‡ (Sharpe)   | (Return.mean() - risk_free_rate) / Return.std() * sqrt(æ™‚é–“å–®ä½)                      | Return                     | âœ…                |
| BAH_å¹´åŒ–å¤æ™®æ¯”ç‡ (BAH_Sharpe)   | (BAH_Return.mean() - risk_free_rate) / BAH_Return.std() * sqrt(æ™‚é–“å–®ä½)                      | BAH_Return                     | âœ…                |
| å¹´åŒ–ç´¢æè«¾æ¯”ç‡ (Sortino)| (Return.mean() - risk_free_rate) / Downside_risk * sqrt(æ™‚é–“å–®ä½)                     | Return                     | âœ…                |
| BAH_å¹´åŒ–ç´¢æè«¾æ¯”ç‡ (BAH_Sortino)| (BAH_Return.mean() - risk_free_rate) / BAH_Downside_risk * sqrt(æ™‚é–“å–®ä½)                     | BAH_Return                     | âœ…                |
| å¡çˆ¾ç‘ªæ¯”ç‡ (Calmar)     | (Annualized_return - risk_free_rate) / abs(Max_drawdown)                                                         | Equity_value               | âœ…                |
| BAH_å¡çˆ¾ç‘ªæ¯”ç‡ (BAH_Calmar)     | (BAH_Annualized_return - risk_free_rate) / abs(BAH_Max_drawdown)                                                         | BAH_Equity, BAH_Drawdown               | âœ… |
| ä¿¡æ¯æ¯”ç‡ (Information_ratio) | (Return.mean() - BAH_Return.mean()) / (Return - BAH_Return).std()                  | Return, BAH_Return         | âœ…                |
| Alpha                   | Return.mean() - [Risk_free_rate + (cov(Return, BAH_Return) / var(BAH_Return)) * (BAH_Return.mean() - Risk_free_rate)]         | Return, BAH_Return, Risk_free_rate         | âœ…                |
| Beta                    | cov(Return, BAH_Return) / var(BAH_Return)                                              | Return, BAH_Return         | âœ…                |
| äº¤æ˜“æ¬¡æ•¸ (Trade_count)  | (Trade_action == 1).sum()                                                              | Trade_action               | âœ…                |
| å‹ç‡ (Win_rate)         | (Trade_return > 0).sum() / (Trade_action == 4).sum()                                   | Trade_return, Trade_action | âœ…                |
| ç›ˆè™§æ¯” (Profit_factor)  | Trade_return[Trade_return > 0].sum() / abs(Trade_return[Trade_return < 0].sum())       | Trade_return               | âœ…                |
| å¹³å‡äº¤æ˜“å›å ± (Avg_trade_return) | Trade_return.mean()                                                            | Trade_return               | âœ…                |
| æœŸæœ›å€¼ (Expectancy)     | (Win_rate Ã— å¹³å‡ç›ˆåˆ©) - (æ•—ç‡ Ã— abs(å¹³å‡è™§æ))                                            | Win_rate, æ•—ç‡, å¹³å‡ç›ˆåˆ©, å¹³å‡è™§æ         | âœ…                |
| æœ€å¤§é€£çºŒè™§æ (Max_consecutive_losses) | é€£çºŒ Trade_return < 0 çš„æœ€å¤§æ¬¡æ•¸æˆ–é‡‘é¡                                 | Trade_return               | âœ…                |
| æŒå€‰æ™‚é–“æ¯”ä¾‹ (Exposure_time) | (Position_size != 0).sum() / len(Position_size) * 100                              | Position_size              | âœ…                |
| æœ€é•·æŒå€‰æ™‚é–“æ¯”ä¾‹ (Max_holding_period_ratio)        | max(å–®æ¬¡æŒå€‰æ™‚é–“) / ç¸½æ™‚é–“ * 100                                                      | Holding_period             | âœ…                |

---

**å‚™è¨»ï¼š**

- ä»¥ä¸Š BAH_æœ€å¤§å›æ’¤ (BAH_Max_drawdown)ã€BAH_å¹³å‡å›æ’¤ (BAH_Average_drawdown)ã€BAH_æ¢å¾©å› å­ (BAH_Recovery_factor)ã€BAH_å¡çˆ¾ç‘ªæ¯”ç‡ (BAH_Calmar) ç­‰ summary æŒ‡æ¨™éœ€æ¯æ—¥è¨˜éŒ„ BAH_Drawdown æ¬„ä½ã€‚
- å…¶é¤˜ä¸»è¡¨æ ¼æ¯æ—¥æ¬„ä½å·²é½Šå…¨ã€‚

**æœ€æ–°ç‹€æ…‹èªªæ˜ï¼š**

- æ‰€æœ‰ summary æŒ‡æ¨™å…¬å¼çš†å¯ç›´æ¥ç”¨ä¸»è¡¨æ ¼æ¬„ä½ï¼ˆå¦‚ Return, BAH_Returnï¼‰å³æ™‚è¨ˆç®—ï¼Œç„¡éœ€é¡å¤–å­˜ summary æ¬„ä½ï¼ˆå¦‚ Mean_bah_returnã€Tracking_errorã€Betaï¼‰ã€‚
- ä¸Šè¡¨æ‰€æœ‰ summary æŒ‡æ¨™æ‰€éœ€ä¸»è¡¨æ ¼æ¬„ä½ç¾å·²é½Šå…¨ï¼Œç„¡éœ€å†è£œæ¯æ—¥æ¬„ä½ã€‚
- æœªä¾†å¦‚æœ‰æ–° summary æŒ‡æ¨™ï¼Œè«‹å…ˆæ–¼ä¸»è¡¨æ ¼è‡ªå‹•æ–°å¢æ¯æ—¥æ¬„ä½ï¼Œå†æ–¼æœ¬è¡¨è£œå……ã€‚

**å¦‚ä½•é©—è­‰ï¼š**

- å»ºè­°ç›´æ¥åŸ·è¡Œ main.pyï¼Œè§€å¯Ÿ debug print æ˜¯å¦æ‰€æœ‰ summary æŒ‡æ¨™éƒ½èƒ½é †åˆ©ç”¢ç”Ÿï¼Œæˆ–æœ‰ç„¡ç¼ºæ¬„ä½éŒ¯èª¤è¨Šæ¯ã€‚
- è‹¥æœ‰ç¼ºæ¬„ä½éŒ¯èª¤ï¼Œè«‹ä¾æ“šæœ¬è¡¨è£œé½Šä¸»è¡¨æ ¼æ¯æ—¥æ¬„ä½ã€‚
