# autorunner é–‹ç™¼è€…èªªæ˜æ–‡ä»¶

## æ¨¡çµ„æ¦‚è¦½

**autorunner** æ˜¯ Lo2cin4BT é‡åŒ–å›æ¸¬æ¡†æ¶çš„è‡ªå‹•åŒ–åŸ·è¡Œæ¨¡çµ„ï¼Œè² è²¬é€éé…ç½®æ–‡ä»¶é©…å‹•å®Œæ•´çš„å›æ¸¬æµç¨‹ã€‚æœ¬æ¨¡çµ„æ¶ˆé™¤ç”¨æˆ¶äº’å‹•éœ€æ±‚ï¼Œå¯¦ç¾æ‰¹æ¬¡å›æ¸¬ã€å¤šé…ç½®åŸ·è¡Œã€çµæœè‡ªå‹•è¨˜éŒ„ç­‰åŠŸèƒ½ï¼Œé©åˆå¤§è¦æ¨¡ç­–ç•¥æ¸¬è©¦èˆ‡åƒæ•¸å„ªåŒ–ã€‚

### ä¸»è¦åŠŸèƒ½

- **é…ç½®æ–‡ä»¶é©…å‹•**ï¼šé€é JSON é…ç½®æ–‡ä»¶å®šç¾©å®Œæ•´çš„å›æ¸¬æµç¨‹ï¼Œç„¡éœ€ç·¨å¯«ä»£ç¢¼
- **å¤šé…ç½®æ‰¹æ¬¡åŸ·è¡Œ**ï¼šæ”¯æ´é¸æ“‡å¤šå€‹é…ç½®æ–‡ä»¶ä¾åºåŸ·è¡Œï¼Œé©åˆæ‰¹æ¬¡æ¸¬è©¦
- **ç›´æ¥èª¿ç”¨åŸç‰ˆæ¨¡çµ„**ï¼šèª¿ç”¨ dataloaderã€backtesterã€metricstracker ç­‰åŸç‰ˆæ¨¡çµ„ï¼Œé¿å…é‡è¤‡å¯¦ç¾
- **é…ç½®é©—è­‰ç³»çµ±**ï¼šè‡ªå‹•é©—è­‰é…ç½®æ–‡ä»¶å®Œæ•´æ€§èˆ‡æ­£ç¢ºæ€§ï¼Œæä¾›è©³ç´°éŒ¯èª¤ä¿¡æ¯
- **å…¨è‡ªå‹•åŸ·è¡Œ**ï¼šç„¡éœ€ç”¨æˆ¶äº’å‹•ï¼Œé©åˆå®šæ™‚ä»»å‹™æˆ–æ‰¹æ¬¡è™•ç†
- **çµ±ä¸€éŒ¯èª¤è™•ç†**ï¼šä½¿ç”¨ Rich Panel é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯ï¼Œæä¾›æ¸…æ™°çš„è¨ºæ–·å»ºè­°

### è¼¸å…¥èˆ‡è¼¸å‡º

**è¼¸å…¥ä¾†æºï¼š**
- JSON é…ç½®æ–‡ä»¶ï¼ˆä½æ–¼ `records/autorunner/`ï¼‰
- é…ç½®æ¨¡æ¿ï¼ˆä½æ–¼ `autorunner/templates/`ï¼‰
- æ•¸æ“šæ–‡ä»¶ï¼ˆé€éé…ç½®æŒ‡å®šï¼‰

**è¼¸å‡ºç›®æ¨™ï¼š**
- å›æ¸¬äº¤æ˜“è¨˜éŒ„ï¼ˆParquet/CSVï¼Œä½æ–¼ `records/backtester/`ï¼‰
- ç¸¾æ•ˆåˆ†æçµæœï¼ˆParquet/Excelï¼Œä½æ–¼ `records/metricstracker/`ï¼‰
- åŸ·è¡Œæ—¥èªŒï¼ˆconsole è¼¸å‡ºï¼‰

---

## å°ˆæ¡ˆçµæ§‹

```plaintext
autorunner/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ Base_autorunner.py                # ä¸»æ§åˆ¶å™¨èˆ‡æµç¨‹å”èª¿
â”œâ”€â”€ ConfigSelector_autorunner.py      # é…ç½®æ–‡ä»¶é¸æ“‡å™¨
â”œâ”€â”€ ConfigValidator_autorunner.py     # é…ç½®æ–‡ä»¶é©—è­‰å™¨
â”œâ”€â”€ ConfigLoader_autorunner.py        # é…ç½®æ–‡ä»¶è¼‰å…¥å™¨
â”œâ”€â”€ DataLoader_autorunner.py          # æ•¸æ“šè¼‰å…¥å°è£å™¨
â”œâ”€â”€ BacktestRunner_autorunner.py      # å›æ¸¬åŸ·è¡Œå°è£å™¨
â”œâ”€â”€ MetricsRunner_autorunner.py       # ç¸¾æ•ˆåˆ†æå°è£å™¨
â”œâ”€â”€ SwitchDataSource_autorunner.py    # å¿«é€Ÿåˆ‡æ›æ•¸æ“šæºå·¥å…·
â”œâ”€â”€ DEV_PLAN.md                       # é–‹ç™¼è¨ˆåŠƒæ–‡ä»¶
â”œâ”€â”€ templates/                        # é…ç½®æ¨¡æ¿ç›®éŒ„
â””â”€â”€ README.md                         # æœ¬æ–‡ä»¶
```

- **Base_autorunner.py**ï¼šä¸»æ§åˆ¶å™¨ï¼Œå”èª¿é…ç½®é¸æ“‡ã€é©—è­‰ã€è¼‰å…¥ã€æ•¸æ“šè¼‰å…¥ã€å›æ¸¬åŸ·è¡Œã€ç¸¾æ•ˆåˆ†æ
- **ConfigSelector_autorunner.py**ï¼šæƒæä¸¦é¸æ“‡é…ç½®æ–‡ä»¶ï¼Œæ”¯æ´å–®é¸æˆ–å¤šé¸
- **ConfigValidator_autorunner.py**ï¼šé©—è­‰é…ç½®æ–‡ä»¶çµæ§‹ã€å¿…è¦æ¬„ä½ã€æ•¸æ“šé¡å‹
- **ConfigLoader_autorunner.py**ï¼šè¼‰å…¥ JSON é…ç½®æ–‡ä»¶ï¼Œè™•ç†ç·¨ç¢¼å•é¡Œ
- **DataLoader_autorunner.py**ï¼šå°è£åŸç‰ˆ dataloaderï¼Œå°‡é…ç½®è½‰æ›ç‚ºåƒæ•¸
- **BacktestRunner_autorunner.py**ï¼šå°è£åŸç‰ˆ backtesterï¼Œè™•ç†æŒ‡æ¨™åƒæ•¸è½‰æ›
- **MetricsRunner_autorunner.py**ï¼šå°è£åŸç‰ˆ metricstrackerï¼Œè‡ªå‹•åŒ–ç¸¾æ•ˆåˆ†æ
- **SwitchDataSource_autorunner.py**ï¼šå¿«é€Ÿåˆ‡æ›é…ç½®æ–‡ä»¶ä¸­çš„æ•¸æ“šæº

---

## æ ¸å¿ƒæ¨¡çµ„èªªæ˜

### 1. Base_autorunner.py - ä¸»æ§åˆ¶å™¨

**åŠŸèƒ½**ï¼šå”èª¿æ•´å€‹è‡ªå‹•åŒ–å›æ¸¬æµç¨‹ï¼Œè² è²¬èª¿ç”¨å„å­æ¨¡çµ„ä¸¦è™•ç†åŸ·è¡Œæµç¨‹

**ä¸»è¦æ–¹æ³•ï¼š**
- `run()` - åŸ·è¡Œå–®å€‹é…ç½®æ–‡ä»¶çš„å®Œæ•´å›æ¸¬æµç¨‹
- `run_batch()` - åŸ·è¡Œå¤šå€‹é…ç½®æ–‡ä»¶çš„æ‰¹æ¬¡å›æ¸¬
- `_run_single_config(config_path)` - åŸ·è¡Œå–®å€‹é…ç½®æ–‡ä»¶
- `_display_execution_summary()` - é¡¯ç¤ºåŸ·è¡Œæ‘˜è¦

**åŸ·è¡Œæµç¨‹ï¼š**
1. é¸æ“‡é…ç½®æ–‡ä»¶ï¼ˆå–®å€‹æˆ–å¤šå€‹ï¼‰
2. é©—è­‰æ‰€æœ‰é…ç½®æ–‡ä»¶
3. ä¾åºåŸ·è¡Œæ¯å€‹é…ç½®ï¼š
   - è¼‰å…¥é…ç½®
   - è¼‰å…¥æ•¸æ“š
   - åŸ·è¡Œå›æ¸¬
   - åˆ†æç¸¾æ•ˆ
4. é¡¯ç¤ºåŸ·è¡Œæ‘˜è¦

**è¼¸å…¥**ï¼šç„¡ï¼ˆé€éäº’å‹•é¸æ“‡é…ç½®æ–‡ä»¶ï¼‰æˆ–é…ç½®æ–‡ä»¶è·¯å¾‘åˆ—è¡¨
**è¼¸å‡º**ï¼šåŸ·è¡Œçµæœæ‘˜è¦

---

### 2. ConfigSelector_autorunner.py - é…ç½®æ–‡ä»¶é¸æ“‡å™¨

**åŠŸèƒ½**ï¼šæƒæä¸¦é¸æ“‡è¦åŸ·è¡Œçš„é…ç½®æ–‡ä»¶

**ä¸»è¦æ–¹æ³•ï¼š**
- `select_configs()` - äº’å‹•å¼é¸æ“‡é…ç½®æ–‡ä»¶
- `_scan_config_files()` - æƒæ `records/autorunner/` ç›®éŒ„
- `_display_config_list(files)` - ä½¿ç”¨ Rich Table é¡¯ç¤ºé…ç½®æ–‡ä»¶åˆ—è¡¨
- `_get_user_selection()` - ç²å–ç”¨æˆ¶é¸æ“‡ï¼ˆæ”¯æ´å–®é¸æˆ–å¤šé¸ï¼‰

**æ”¯æ´åŠŸèƒ½ï¼š**
- è‡ªå‹•æƒæ `records/autorunner/*.json` æ–‡ä»¶
- æ’é™¤æ¨¡æ¿æ–‡ä»¶ï¼ˆ`*template*.json`ï¼‰
- æ”¯æ´é¸æ“‡ã€Œå…¨éƒ¨ã€æˆ–ç‰¹å®šæ–‡ä»¶
- ä½¿ç”¨ Rich Table ç¾åŒ–é¡¯ç¤º

**è¼¸å…¥**ï¼šç„¡
**è¼¸å‡º**ï¼šé¸å®šçš„é…ç½®æ–‡ä»¶è·¯å¾‘åˆ—è¡¨

---

### 3. ConfigValidator_autorunner.py - é…ç½®é©—è­‰å™¨

**åŠŸèƒ½**ï¼šé©—è­‰é…ç½®æ–‡ä»¶çš„å®Œæ•´æ€§å’Œæ­£ç¢ºæ€§

**ä¸»è¦æ–¹æ³•ï¼š**
- `validate_config(config)` - é©—è­‰å–®å€‹é…ç½®æ–‡ä»¶
- `validate_batch(config_paths)` - æ‰¹æ¬¡é©—è­‰å¤šå€‹é…ç½®æ–‡ä»¶
- `_validate_dataloader_config(config)` - é©—è­‰æ•¸æ“šè¼‰å…¥é…ç½®
- `_validate_backtester_config(config)` - é©—è­‰å›æ¸¬é…ç½®
- `_validate_metricstracker_config(config)` - é©—è­‰ç¸¾æ•ˆåˆ†æé…ç½®

**é©—è­‰é …ç›®ï¼š**
- å¿…è¦æ¬„ä½å­˜åœ¨æ€§ï¼ˆdataloaderã€backtesterã€metricstrackerï¼‰
- æ•¸æ“šé¡å‹æ­£ç¢ºæ€§ï¼ˆå­—ç¬¦ä¸²ã€æ•¸å€¼ã€å¸ƒæ—å€¼ç­‰ï¼‰
- åƒæ•¸ç¯„åœåˆç†æ€§ï¼ˆæ—¥æœŸæ ¼å¼ã€æ•¸å€¼ç¯„åœç­‰ï¼‰
- æ–‡ä»¶è·¯å¾‘æœ‰æ•ˆæ€§ï¼ˆé æ¸¬å› å­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼‰
- æŒ‡æ¨™åƒæ•¸æ ¼å¼æ­£ç¢ºæ€§ï¼ˆç¯„åœæ ¼å¼ã€ç­–ç•¥é…å°ç­‰ï¼‰

**è¼¸å…¥**ï¼šé…ç½®å­—å…¸æˆ–é…ç½®æ–‡ä»¶è·¯å¾‘
**è¼¸å‡º**ï¼šé©—è­‰çµæœï¼ˆæˆåŠŸ/å¤±æ•— + éŒ¯èª¤ä¿¡æ¯ï¼‰

---

### 4. ConfigLoader_autorunner.py - é…ç½®è¼‰å…¥å™¨

**åŠŸèƒ½**ï¼šè¼‰å…¥ JSON é…ç½®æ–‡ä»¶ï¼Œè™•ç†ç·¨ç¢¼å•é¡Œ

**ä¸»è¦æ–¹æ³•ï¼š**
- `load_config(config_path)` - è¼‰å…¥å–®å€‹é…ç½®æ–‡ä»¶
- `_read_json_file(file_path)` - è®€å– JSON æ–‡ä»¶ï¼ˆè™•ç†ç·¨ç¢¼ï¼‰

**ç‰¹é»ï¼š**
- è‡ªå‹•è™•ç† UTF-8 ç·¨ç¢¼
- æ•ç² JSON æ ¼å¼éŒ¯èª¤
- ä½¿ç”¨ Rich Panel é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
- æ”¯æ´è¨»é‡‹æ¬„ä½ï¼ˆ`_help`ã€`_comment` ç­‰ï¼‰

**è¼¸å…¥**ï¼šé…ç½®æ–‡ä»¶è·¯å¾‘
**è¼¸å‡º**ï¼šé…ç½®å­—å…¸

---

### 5. DataLoader_autorunner.py - æ•¸æ“šè¼‰å…¥å°è£å™¨

**åŠŸèƒ½**ï¼šå°è£åŸç‰ˆ dataloader æ¨¡çµ„ï¼Œå°‡é…ç½®è½‰æ›ç‚ºæ•¸æ“šè¼‰å…¥åƒæ•¸

**ä¸»è¦æ–¹æ³•ï¼š**
- `load_data(config)` - æ ¹æ“šé…ç½®è¼‰å…¥æ•¸æ“š
- `_load_predictor_data(config)` - è¼‰å…¥é æ¸¬å› å­æ•¸æ“š
- `_calculate_returns(config)` - è¨ˆç®—æ”¶ç›Šç‡
- `_process_difference(config)` - è™•ç†å·®åˆ†
- `get_loading_summary()` - ç²å–è¼‰å…¥æ‘˜è¦

**æ”¯æ´åŠŸèƒ½ï¼š**
- **ç›´æ¥èª¿ç”¨åŸç‰ˆæ–¹æ³•**ï¼šä½¿ç”¨ `FileLoader.detect_and_convert_timestamp()` ç­‰åŸç‰ˆæ–¹æ³•
- **è‡ªå‹•æª¢æ¸¬ timestamp æ ¼å¼**ï¼šæ”¯æ´ç§’ç´šå’Œæ¯«ç§’ç´š Unix timestamp è‡ªå‹•è½‰æ›
- **å¤šæ•¸æ“šæºæ”¯æ´**ï¼šYahoo Financeã€Binanceã€Coinbaseã€æœ¬åœ°æ–‡ä»¶
- **é æ¸¬å› å­è™•ç†**ï¼šè‡ªå‹•å°é½Šæ™‚é–“åºåˆ—ï¼Œæ”¯æ´å·®åˆ†è™•ç†
- **æ™‚é–“æ¬„ä½æ™ºèƒ½è­˜åˆ¥**ï¼šè‡ªå‹•è­˜åˆ¥ timeã€dateã€timestampã€datetimeã€period ç­‰æ¬„ä½ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰

**è¨­è¨ˆåŸå‰‡ï¼š**
- ä¸é‡è¤‡å¯¦ç¾åŸç‰ˆ dataloader å·²æœ‰çš„åŠŸèƒ½
- ç›´æ¥èª¿ç”¨åŸç‰ˆæ–¹æ³•ï¼ˆå¦‚ `detect_and_convert_timestamp`ï¼‰
- åªè² è²¬é…ç½®è½‰æ›å’Œåƒæ•¸å‚³é

**é…ç½®ç¯„ä¾‹ï¼š**
```json
{
  "dataloader": {
    "source": "binance",
    "start_date": "2020-01-01",
    "binance_config": {
      "symbol": "BTCUSDT",
      "interval": "1d"
    },
    "predictor_config": {
      "predictor_path": "records/dataloader/import/predictor.csv",
      "predictor_column": "aggregated",
      "time_column": "timestamp",
      "time_format": ""  // âš ï¸ ç•™ç©ºè®“ç³»çµ±è‡ªå‹•æª¢æ¸¬ timestamp
    }
  }
}
```

**è¼¸å…¥**ï¼šé…ç½®å­—å…¸
**è¼¸å‡º**ï¼šæ¨™æº–åŒ–çš„ DataFrame + é »ç‡å­—ä¸²

---

### 6. BacktestRunner_autorunner.py - å›æ¸¬åŸ·è¡Œå°è£å™¨

**åŠŸèƒ½**ï¼šå°è£åŸç‰ˆ backtester æ¨¡çµ„ï¼Œå°‡é…ç½®è½‰æ›ç‚ºå›æ¸¬åƒæ•¸

**ä¸»è¦æ–¹æ³•ï¼š**
- `run_backtest(data, config)` - åŸ·è¡Œå›æ¸¬
- `_convert_indicator_params(config)` - è½‰æ›æŒ‡æ¨™åƒæ•¸
- `_prepare_backtest_config_for_engine(config)` - æº–å‚™å›æ¸¬é…ç½®

**æ”¯æ´åŠŸèƒ½ï¼š**
- è‡ªå‹•è½‰æ›æŒ‡æ¨™åƒæ•¸æ ¼å¼ï¼ˆå¾é…ç½®å­—å…¸åˆ° `IndicatorParams` ç‰©ä»¶ï¼‰
- æ”¯æ´å¤šç¨®æŒ‡æ¨™ï¼šMAï¼ˆ12ç¨®ï¼‰ã€BOLLï¼ˆ4ç¨®ï¼‰ã€HLï¼ˆ6ç¨®ï¼‰ã€PERCï¼ˆ4ç¨®ï¼‰ã€NDAYï¼ˆ2ç¨®ï¼‰ã€VALUEï¼ˆ1ç¨®ï¼‰
- è‡ªå‹•è£œé½Šåƒæ•¸ç¯„åœï¼ˆå–®ä¸€æ•¸å€¼è‡ªå‹•è½‰ç‚ºç¯„åœæ ¼å¼ï¼‰
- æ”¯æ´å¤šç­–ç•¥é…å°çµ„åˆ
- è‡ªå‹•åŒ–åŸ·è¡Œï¼ˆç„¡éœ€ç”¨æˆ¶ç¢ºèªï¼‰

**é…ç½®ç¯„ä¾‹ï¼š**
```json
{
  "backtester": {
    "selected_predictor": "X",
    "condition_pairs": [
      {"entry": ["MA1"], "exit": ["MA4"]}
    ],
    "indicator_params": {
      "MA1_strategy_1": {
        "ma_type": "SMA",
        "ma_range": "10:100:10"
      },
      "MA4_strategy_1": {
        "ma_type": "SMA",
        "ma_range": "20:200:20"
      }
    },
    "trading_params": {
      "transaction_cost": 0.001,
      "slippage": 0.0005,
      "trade_delay": 1,
      "trade_price": "open"
    }
  }
}
```

**è¼¸å…¥**ï¼šæ•¸æ“š DataFrame + é…ç½®å­—å…¸
**è¼¸å‡º**ï¼šå›æ¸¬çµæœåˆ—è¡¨

---

### 7. MetricsRunner_autorunner.py - ç¸¾æ•ˆåˆ†æå°è£å™¨

**åŠŸèƒ½**ï¼šå°è£åŸç‰ˆ metricstracker æ¨¡çµ„ï¼Œè‡ªå‹•åŒ–ç¸¾æ•ˆåˆ†æ

**ä¸»è¦æ–¹æ³•ï¼š**
- `run_metrics(config)` - åŸ·è¡Œç¸¾æ•ˆåˆ†æ
- `_select_parquet_files(mode)` - é¸æ“‡è¦åˆ†æçš„ Parquet æ–‡ä»¶
- `_process_single_parquet(file_path, config)` - è™•ç†å–®å€‹ Parquet æ–‡ä»¶

**æ”¯æ´åŠŸèƒ½ï¼š**
- è‡ªå‹•é¸æ“‡æœ€æ–°çš„ Parquet æ–‡ä»¶ï¼ˆauto æ¨¡å¼ï¼‰
- æ‰¹æ¬¡è™•ç†æ‰€æœ‰ Parquet æ–‡ä»¶ï¼ˆall æ¨¡å¼ï¼‰
- è‡ªå‹•è¨ˆç®—ç¸¾æ•ˆæŒ‡æ¨™ï¼ˆSharpeã€Sortinoã€Max Drawdown ç­‰ï¼‰
- è‡ªå‹•å°å‡ºåˆ†æçµæœ

**é…ç½®ç¯„ä¾‹ï¼š**
```json
{
  "metricstracker": {
    "enable_metrics_analysis": true,
    "risk_free_rate": 0.04,
    "time_unit": 365,
    "file_selection_mode": "auto"
  }
}
```

**è¼¸å…¥**ï¼šé…ç½®å­—å…¸
**è¼¸å‡º**ï¼šç¸¾æ•ˆåˆ†æçµæœ

---

### 8. SwitchDataSource_autorunner.py - æ•¸æ“šæºåˆ‡æ›å·¥å…·

**åŠŸèƒ½**ï¼šå¿«é€Ÿä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ•¸æ“šæºè¨­å®š

**ä¸»è¦æ–¹æ³•ï¼š**
- `switch_data_source(config_path, new_source)` - åˆ‡æ›æ•¸æ“šæº
- `_update_config_source(config, source)` - æ›´æ–°é…ç½®ä¸­çš„æ•¸æ“šæº

**æ”¯æ´çš„æ•¸æ“šæºï¼š**
- `yfinance` - Yahoo Finance API
- `binance` - Binance API
- `coinbase` - Coinbase API
- `file` - æœ¬åœ°æ–‡ä»¶

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```python
from autorunner.SwitchDataSource_autorunner import switch_data_source

# å°‡é…ç½®æ–‡ä»¶çš„æ•¸æ“šæºåˆ‡æ›ç‚º Binance
switch_data_source("records/autorunner/my_config.json", "binance")
```

---

## è¨­è¨ˆåŸå‰‡èˆ‡æ¶æ§‹

### æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

1. **ç›´æ¥èª¿ç”¨åŸç‰ˆæ¨¡çµ„**ï¼šä¸é‡è¤‡å¯¦ç¾åŠŸèƒ½ï¼Œåªè² è²¬é…ç½®è½‰æ›å’Œåƒæ•¸å‚³é
2. **çµ±ä¸€ UI æ¨£å¼**ï¼šä½¿ç”¨èˆ‡åŸç‰ˆç›¸åŒçš„ Rich Panel æ¨£å¼ï¼ˆç´…è‰²æ¨™é¡Œ `#8f1511`ï¼Œé»ƒè‰²é‚Šæ¡† `#dbac30`ï¼‰
3. **ç„¡ç”¨æˆ¶äº’å‹•**ï¼šå®Œå…¨è‡ªå‹•åŒ–åŸ·è¡Œï¼Œé©åˆæ‰¹æ¬¡è™•ç†
4. **å®Œå–„éŒ¯èª¤è™•ç†**ï¼šæä¾›è©³ç´°çš„éŒ¯èª¤è¨ºæ–·å’Œä¿®å¾©å»ºè­°
5. **å‘å¾Œå…¼å®¹**ï¼šé…ç½®æ ¼å¼ä¿æŒç©©å®šï¼Œæ”¯æ´èˆŠç‰ˆé…ç½®

### æ¨¡çµ„ä¾è³´é—œä¿‚

```mermaid
graph TD
    A[Base_autorunner] --> B[ConfigSelector]
    A --> C[ConfigValidator]
    A --> D[ConfigLoader]
    A --> E[DataLoader_autorunner]
    A --> F[BacktestRunner_autorunner]
    A --> G[MetricsRunner_autorunner]
    
    E --> H[dataloader.base_loader]
    E --> I[dataloader.file_loader]
    F --> J[backtester.Base_backtester]
    G --> K[metricstracker.Base_metricstracker]
    
    B --> L[records/autorunner/*.json]
    C --> L
    D --> L
```

### æ•¸æ“šæµè¨­è¨ˆ

```mermaid
sequenceDiagram
    participant User
    participant Base as Base_autorunner
    participant CS as ConfigSelector
    participant CV as ConfigValidator
    participant CL as ConfigLoader
    participant DL as DataLoader_autorunner
    participant BT as BacktestRunner_autorunner
    participant MT as MetricsRunner_autorunner
    
    User->>Base: åŸ·è¡Œ autorunner
    Base->>CS: é¸æ“‡é…ç½®æ–‡ä»¶
    CS-->>User: é¡¯ç¤ºé…ç½®åˆ—è¡¨
    User->>CS: é¸æ“‡è¦åŸ·è¡Œçš„é…ç½®
    CS-->>Base: è¿”å›é…ç½®æ–‡ä»¶åˆ—è¡¨
    Base->>CV: é©—è­‰æ‰€æœ‰é…ç½®
    CV-->>Base: è¿”å›é©—è­‰çµæœ
    
    alt é©—è­‰å¤±æ•—
        Base-->>User: é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
    else é©—è­‰æˆåŠŸ
        loop æ¯å€‹é…ç½®æ–‡ä»¶
            Base->>CL: è¼‰å…¥é…ç½®
            CL-->>Base: è¿”å›é…ç½®æ•¸æ“š
            Base->>DL: è¼‰å…¥æ•¸æ“š
            DL-->>Base: è¿”å›æ•¸æ“š
            Base->>BT: åŸ·è¡Œå›æ¸¬
            BT-->>Base: è¿”å›å›æ¸¬çµæœ
            Base->>MT: åˆ†æç¸¾æ•ˆ
            MT-->>Base: è¿”å›åˆ†æçµæœ
        end
        Base-->>User: é¡¯ç¤ºåŸ·è¡Œæ‘˜è¦
    end
```

---

## é…ç½®æ–‡ä»¶èªªæ˜

### é…ç½®æ–‡ä»¶çµæ§‹

å®Œæ•´çš„é…ç½®æ–‡ä»¶åŒ…å«ä¸‰å€‹ä¸»è¦å€å¡Šï¼š

```json
{
  "_version": "1.0.0",
  "_description": "é…ç½®æ–‡ä»¶æè¿°",
  "dataloader": {
    // æ•¸æ“šè¼‰å…¥é…ç½®
  },
  "backtester": {
    // å›æ¸¬åŸ·è¡Œé…ç½®
  },
  "metricstracker": {
    // ç¸¾æ•ˆåˆ†æé…ç½®
  }
}
```

### 1. æ•¸æ“šè¼‰å…¥é…ç½® (dataloader)

#### é€šç”¨é…ç½®

```json
"dataloader": {
  "source": "binance",           // æ•¸æ“šä¾†æºï¼šyfinance | binance | coinbase | file
  "frequency": "1d",              // æ•¸æ“šé »ç‡ï¼š1m, 5m, 15m, 1h, 4h, 1d ç­‰
  "start_date": "2020-01-01",     // é–‹å§‹æ—¥æœŸ (YYYY-MM-DD)
  "handle_missing_values": "fill",
  "missing_value_strategy": "A"   // A=å‰å‘å¡«å……, B,N=å‰NæœŸå‡å€¼, C,x=å›ºå®šå€¼
}
```

#### Yahoo Finance é…ç½®

```json
"yfinance_config": {
  "symbol": "AAPL",      // è‚¡ç¥¨ä»£ç¢¼
  "period": "1y",        // æ™‚é–“ç¯„åœ
  "interval": "1d"       // æ•¸æ“šé–“éš”
}
```

#### Binance é…ç½®

```json
"binance_config": {
  "symbol": "BTCUSDT",   // äº¤æ˜“å°
  "interval": "1d"       // Kç·šé–“éš”
}
```

#### æœ¬åœ°æ–‡ä»¶é…ç½®

```json
"file_config": {
  "file_path": "records/dataloader/import/data.csv",
  "time_column": "time",
  "time_format": "%Y-%m-%d %H:%M:%S",  // æˆ–ç•™ç©ºè‡ªå‹•æ¨æ–·
  "open_column": "open",
  "high_column": "high",
  "low_column": "low",
  "close_column": "close"
}
```

#### é æ¸¬å› å­é…ç½®

```json
"predictor_config": {
  "predictor_path": "records/dataloader/import/predictor.csv",
  "predictor_column": "aggregated",
  "skip_predictor": false,
  "time_column": "timestamp",
  "time_format": ""  // âš ï¸ å¦‚æœæ˜¯ Unix timestampï¼ˆç´”æ•¸å­—ï¼‰ï¼Œè«‹ç•™ç©ºï¼
}
```

**é‡è¦æç¤ºï¼šTimestamp æ ¼å¼è™•ç†**

- **Unix timestampï¼ˆç´”æ•¸å­—ï¼‰**ï¼š`"time_format": ""` ç•™ç©ºï¼Œç³»çµ±æœƒè‡ªå‹•æª¢æ¸¬ä¸¦è½‰æ›
  - æ”¯æ´ç§’ç´šï¼ˆ10ä½æ•¸ï¼Œå¦‚ 1609459200ï¼‰
  - æ”¯æ´æ¯«ç§’ç´šï¼ˆ13ä½æ•¸ï¼Œå¦‚ 1609459200500ï¼‰
- **å­—ç¬¦ä¸²æ—¥æœŸæ ¼å¼**ï¼šéœ€æŒ‡å®šæ ¼å¼ï¼Œå¦‚ `"%Y-%m-%d"` æˆ– `"%d/%m/%Y %H:%M:%S"`

### 2. å›æ¸¬é…ç½® (backtester)

#### åŸºæœ¬é…ç½®

```json
"backtester": {
  "selected_predictor": "X",     // é æ¸¬å› å­æ¬„ä½åç¨±
  "initial_capital": 1000000     // åˆå§‹è³‡é‡‘
}
```

#### ç­–ç•¥æ¢ä»¶é…å°

```json
"condition_pairs": [
  {
    "entry": ["MA1"],          // é–‹å€‰æ¢ä»¶
    "exit": ["MA4"]            // å¹³å€‰æ¢ä»¶
  },
  {
    "entry": ["MA1", "MA9"],   // å¤šæ¢ä»¶é–‹å€‰
    "exit": ["MA4"]
  },
  {
    "entry": ["BOLL1"],
    "exit": ["BOLL4"]
  }
]
```

#### æŒ‡æ¨™åƒæ•¸é…ç½®

**ç§»å‹•å¹³å‡æŒ‡æ¨™ (MA1-MA12)ï¼š**
```json
"MA1_strategy_1": {
  "ma_type": "SMA",          // SMA, EMA, WMA
  "ma_range": "10:100:10"    // èµ·å§‹:çµæŸ:æ­¥é•·
}
```

**å¸ƒæ—å¸¶æŒ‡æ¨™ (BOLL1-BOLL4)ï¼š**
```json
"BOLL1_strategy_1": {
  "ma_range": "10:100:10",
  "sd_multi": "1,1.5,2"      // æ¨™æº–å·®å€æ•¸ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
}
```

**é«˜ä½é»æŒ‡æ¨™ (HL1-HL6)ï¼š**
```json
"HL1_strategy_1": {
  "n_range": "1:5:1",
  "m_range": "10:100:10"
}
```

**ç™¾åˆ†ä½æŒ‡æ¨™ (PERC1-PERC4)ï¼š**
```json
"PERC1_strategy_1": {
  "window_range": "10:100:10",
  "percentile_range": "90:100:5"
}
```

**Næ—¥é€±æœŸæŒ‡æ¨™ (NDAY1-NDAY2)ï¼š**
```json
"NDAY1_strategy_1": {
  "nday_value": "5"          // Næ—¥æ•¸å€¼
}
```

**æ•¸å€¼æŒ‡æ¨™ (VALUE1)ï¼š**
```json
"VALUE1_strategy_1": {
  "threshold": "0"           // é–¾å€¼
}
```

#### äº¤æ˜“åƒæ•¸é…ç½®

```json
"trading_params": {
  "transaction_cost": 0.001,   // äº¤æ˜“æˆæœ¬ï¼ˆæ‰‹çºŒè²»ï¼‰
  "slippage": 0.0005,         // æ»‘é»
  "trade_delay": 1,           // äº¤æ˜“å»¶é²ï¼š0=ç•¶æ ¹, 1=ä¸‹ä¸€æ ¹
  "trade_price": "open"       // æˆäº¤åƒ¹æ ¼ï¼šopen / close
}
```

### 3. ç¸¾æ•ˆåˆ†æé…ç½® (metricstracker)

```json
"metricstracker": {
  "enable_metrics_analysis": true,  // æ˜¯å¦å•Ÿç”¨ç¸¾æ•ˆåˆ†æ
  "risk_free_rate": 0.04,          // ç„¡é¢¨éšªåˆ©ç‡ï¼ˆ0.04 = 4%ï¼‰
  "time_unit": 365,                // å¹´åŒ–å–®ä½ï¼šæ—¥ç·šè‚¡ç¥¨252, æ—¥ç·šå¹£365
  "file_selection_mode": "auto",   // auto=æœ€æ–°ä¸€å€‹, all=å…¨éƒ¨
  "export_format": "excel"         // csv, excel, json
}
```

---

## ä½¿ç”¨æµç¨‹èˆ‡ç¯„ä¾‹

### ä½¿ç”¨æµç¨‹åœ–

```mermaid
flowchart TD
    Start[é–‹å§‹] --> Step1[1. æº–å‚™é…ç½®æ–‡ä»¶]
    Step1 --> Step2[2. é‹è¡Œ main.py]
    Step2 --> Step3[3. é¸æ“‡ Autorunner æ¨¡å¼]
    Step3 --> Step4[4. é¸æ“‡é…ç½®æ–‡ä»¶]
    Step4 --> Step5[5. é…ç½®é©—è­‰]
    
    Step5 --> Valid{é©—è­‰é€šé?}
    Valid -->|å¦| Error[é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯]
    Error --> Fix[ä¿®æ­£é…ç½®]
    Fix --> Step5
    
    Valid -->|æ˜¯| Step6[6. è‡ªå‹•è¼‰å…¥æ•¸æ“š]
    Step6 --> Step7[7. è‡ªå‹•åŸ·è¡Œå›æ¸¬]
    Step7 --> Step8[8. è‡ªå‹•åˆ†æç¸¾æ•ˆ]
    Step8 --> End[å®Œæˆ]
```

### ç¯„ä¾‹ 1ï¼šå–®å€‹é…ç½®æ–‡ä»¶åŸ·è¡Œ

**æ­¥é©Ÿ 1ï¼šæº–å‚™é…ç½®æ–‡ä»¶**

å‰µå»ºæˆ–ä¿®æ”¹ `records/autorunner/my_strategy.json`ï¼š
```json
{
  "_version": "1.0.0",
  "_description": "æˆ‘çš„ BTC å›æ¸¬ç­–ç•¥",
  "dataloader": {
    "source": "binance",
    "binance_config": {
      "symbol": "BTCUSDT",
      "interval": "1d"
    },
    "start_date": "2020-01-01",
    "predictor_config": {
      "skip_predictor": true
    }
  },
  "backtester": {
    "selected_predictor": "X",
    "condition_pairs": [
      {"entry": ["MA1"], "exit": ["MA4"]}
    ],
    "indicator_params": {
      "MA1_strategy_1": {"ma_type": "SMA", "ma_range": "10:50:10"},
      "MA4_strategy_1": {"ma_type": "SMA", "ma_range": "20:100:20"}
    }
  }
}
```

**æ­¥é©Ÿ 2ï¼šé‹è¡Œ autorunner**
```python
python main.py
# é¸æ“‡ "3" - Autorunner è‡ªå‹•åŒ–å›æ¸¬
# é¸æ“‡é…ç½®æ–‡ä»¶ç·¨è™Ÿ
```

**æ­¥é©Ÿ 3ï¼šæŸ¥çœ‹çµæœ**
- å›æ¸¬è¨˜éŒ„ï¼š`records/backtester/`
- ç¸¾æ•ˆåˆ†æï¼š`records/metricstracker/`

---

### ç¯„ä¾‹ 2ï¼šæ‰¹æ¬¡åŸ·è¡Œå¤šå€‹é…ç½®

**å ´æ™¯**ï¼šæ¸¬è©¦ä¸åŒæ•¸æ“šæºçš„ç›¸åŒç­–ç•¥

æº–å‚™ä¸‰å€‹é…ç½®æ–‡ä»¶ï¼š
- `strategy_btc.json` - ä½¿ç”¨ Binance BTC æ•¸æ“š
- `strategy_eth.json` - ä½¿ç”¨ Binance ETH æ•¸æ“š
- `strategy_aapl.json` - ä½¿ç”¨ Yahoo Finance AAPL æ•¸æ“š

é‹è¡Œ autorunner ä¸¦é¸æ“‡ã€Œå…¨éƒ¨ã€ï¼Œç³»çµ±æœƒä¾åºåŸ·è¡Œæ‰€æœ‰é…ç½®ã€‚

---

### ç¯„ä¾‹ 3ï¼šä½¿ç”¨ Timestamp é æ¸¬å› å­

**å ´æ™¯**ï¼šä½¿ç”¨åŒ…å« Unix timestamp çš„é æ¸¬å› å­æ•¸æ“š

é…ç½®æ–‡ä»¶ï¼š
```json
{
  "dataloader": {
    "source": "binance",
    "binance_config": {
      "symbol": "BTCUSDT",
      "interval": "1d"
    },
    "predictor_config": {
      "predictor_path": "records/dataloader/import/crypto_metrics.csv",
      "predictor_column": "aggregated",
      "time_column": "timestamp",
      "time_format": ""  // âš ï¸ é‡è¦ï¼šç•™ç©ºè®“ç³»çµ±è‡ªå‹•æª¢æ¸¬ timestampï¼
    }
  }
}
```

**ç³»çµ±æœƒè‡ªå‹•ï¼š**
1. æª¢æ¸¬åˆ° timestamp æ¬„ä½æ˜¯æ•¸å€¼å‹æ…‹
2. åˆ¤æ–·æ˜¯ç§’ç´šï¼ˆ10ä½æ•¸ï¼‰æˆ–æ¯«ç§’ç´šï¼ˆ13ä½æ•¸ï¼‰
3. è‡ªå‹•è½‰æ›ç‚º datetime æ ¼å¼
4. èˆ‡åƒ¹æ ¼æ•¸æ“šå°é½Šåˆä½µ

**é¡¯ç¤ºç¯„ä¾‹ï¼š**
```
â•­â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ“Š æ•¸æ“šè¼‰å…¥ Dataloader â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ æª¢æ¸¬åˆ°ç§’ç´štimestampæ ¼å¼ï¼Œæ­£åœ¨è½‰æ›...   â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â•­â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ“Š æ•¸æ“šè¼‰å…¥ Dataloader â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ timestampè½‰æ›æˆåŠŸï¼Œæ ¼å¼ç‚ºï¼š2019-12-31  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

---

## æŠ€è¡“ç´°ç¯€

### ä¾è³´å¥—ä»¶

- **pandas**ï¼šæ•¸æ“šè™•ç†
- **numpy**ï¼šæ•¸å€¼è¨ˆç®—
- **rich**ï¼šçµ‚ç«¯ UI ç¾åŒ–
- **json**ï¼šé…ç½®æ–‡ä»¶è®€å¯«
- **logging**ï¼šæ—¥èªŒè¨˜éŒ„
- **åŸç‰ˆæ¨¡çµ„**ï¼šdataloaderã€backtesterã€metricstracker

### é…ç½®æ–‡ä»¶è¦ç¯„

**æª”æ¡ˆä½ç½®**ï¼š`records/autorunner/*.json`

**å‘½åè¦ç¯„**ï¼š
- æ¨¡æ¿æ–‡ä»¶ï¼šåŒ…å« `template` å­—æ¨£ï¼ˆæœƒè¢«é¸æ“‡å™¨å¿½ç•¥ï¼‰
- å¯¦éš›é…ç½®ï¼šä»»æ„æœ‰æ„ç¾©çš„åç¨±ï¼ˆå¦‚ `btc_ma_strategy.json`ï¼‰

**ç·¨ç¢¼è¦æ±‚**ï¼š
- å¿…é ˆä½¿ç”¨ UTF-8 ç·¨ç¢¼
- ä¸æ”¯æ´ BOMï¼ˆByte Order Markï¼‰
- JSON æ ¼å¼å¿…é ˆæ­£ç¢ºï¼ˆä½¿ç”¨ JSON validator æª¢æŸ¥ï¼‰

**è¨»é‡‹æ¬„ä½**ï¼š
- `_version`ï¼šé…ç½®æ–‡ä»¶ç‰ˆæœ¬
- `_description`ï¼šé…ç½®æ–‡ä»¶æè¿°
- `_help`ï¼šæ¬„ä½èªªæ˜ï¼ˆä¸å½±éŸ¿åŸ·è¡Œï¼‰
- `_comment`ï¼šè¨»é‡‹ï¼ˆä¸å½±éŸ¿åŸ·è¡Œï¼‰

### åƒæ•¸è½‰æ›é‚è¼¯

#### å–®ä¸€æ•¸å€¼è½‰ç¯„åœæ ¼å¼

é…ç½®ä¸­å¯ä»¥ä½¿ç”¨å–®ä¸€æ•¸å€¼ï¼Œç³»çµ±æœƒè‡ªå‹•è½‰æ›ï¼š

```json
// é…ç½®æ–‡ä»¶ä¸­å¯«ï¼š
"ma_range": "50"

// è‡ªå‹•è½‰æ›ç‚ºï¼š
"ma_range": "50:50:1"
```

#### æŒ‡æ¨™åƒæ•¸æ˜ å°„

å¾é…ç½®å­—å…¸è½‰æ›ç‚º `IndicatorParams` ç‰©ä»¶ï¼š

```python
# é…ç½®
{
  "MA1_strategy_1": {"ma_type": "SMA", "ma_range": "10:50:10"}
}

# è½‰æ›ç‚º
IndicatorParams(
  indicator_name="MA1",
  strategy_id=1,
  params={"ma_type": "SMA", "ma_range": "10:50:10"}
)
```

### Timestamp è‡ªå‹•è½‰æ›æ©Ÿåˆ¶

autorunner èª¿ç”¨åŸç‰ˆ dataloader çš„ `detect_and_convert_timestamp()` æ–¹æ³•ï¼š

**æª¢æ¸¬é‚è¼¯ï¼š**
1. æª¢æŸ¥ Time æ¬„ä½æ˜¯å¦ç‚ºæ•¸å€¼å‹æ…‹
2. æª¢æŸ¥æ•¸å€¼æ˜¯å¦ç‚º numpy.int64ã€numpy.float64 ç­‰é¡å‹ï¼ˆä¸åªæ˜¯ Python int/floatï¼‰
3. æ ¹æ“šæ•¸å€¼å¤§å°åˆ¤æ–·ï¼š
   - `value > 1e10` â†’ æ¯«ç§’ç´š timestamp
   - `value <= 1e10` â†’ ç§’ç´š timestamp
4. ä½¿ç”¨ `pd.to_datetime(unit="s"æˆ–"ms")` è½‰æ›

**é¿å…é‡è¤‡è½‰æ›ï¼š**
- `predictor_loader._process_time_column()` æª¢æŸ¥å·²æ˜¯ datetime æ ¼å¼å‰‡è·³é
- `validator_loader._handle_time_index()` æª¢æŸ¥å·²æ˜¯ datetime æ ¼å¼å‰‡è·³é

---

## ç¶­è­·èˆ‡æ“´å……æŒ‡å—

### æ–°å¢æ•¸æ“šæºæ”¯æ´

è‹¥è¦æ–°å¢æ–°çš„æ•¸æ“šæºï¼ˆå¦‚ Krakenï¼‰ï¼Œéœ€è¦ï¼š

1. åœ¨åŸç‰ˆ `dataloader` æ¨¡çµ„ä¸­å¯¦ç¾ `KrakenLoader`
2. åœ¨ `DataLoader_autorunner.py` ä¸­æ·»åŠ å°æ‡‰çš„è¼‰å…¥é‚è¼¯
3. åœ¨é…ç½®æ¨¡æ¿ä¸­æ·»åŠ  `kraken_config` å€å¡Š
4. æ›´æ–°æœ¬ README çš„é…ç½®èªªæ˜

**ä¸è¦åœ¨ autorunner ä¸­é‡è¤‡å¯¦ç¾æ•¸æ“šè¼‰å…¥é‚è¼¯ï¼**

### æ–°å¢æŒ‡æ¨™æ”¯æ´

è‹¥è¦æ–°å¢æ–°çš„æŠ€è¡“æŒ‡æ¨™ï¼ˆå¦‚ RSIï¼‰ï¼Œéœ€è¦ï¼š

1. åœ¨åŸç‰ˆ `backtester` æ¨¡çµ„ä¸­å¯¦ç¾æŒ‡æ¨™é¡
2. åœ¨ `BacktestRunner_autorunner.py` çš„ `_convert_indicator_params()` ä¸­æ·»åŠ åƒæ•¸è½‰æ›é‚è¼¯
3. åœ¨é…ç½®æ¨¡æ¿ä¸­æ·»åŠ  RSI åƒæ•¸ç¯„ä¾‹
4. æ›´æ–°æœ¬ README çš„æŒ‡æ¨™èªªæ˜

### ä¿®æ”¹ UI æ¨£å¼

autorunner ä½¿ç”¨èˆ‡åŸç‰ˆç›¸åŒçš„ UI æ¨£å¼ï¼Œä¿®æ”¹æ™‚éœ€ä¿æŒä¸€è‡´ï¼š

- æ¨™é¡Œé¡è‰²ï¼š`#8f1511`ï¼ˆç´…è‰²ï¼‰
- é‚Šæ¡†é¡è‰²ï¼š`#dbac30`ï¼ˆé»ƒè‰²ï¼‰
- æ¨™é¡Œæ ¼å¼ï¼š`[bold #8f1511]ğŸ“Š æ•¸æ“šè¼‰å…¥ Dataloader[/bold #8f1511]`

è‹¥éœ€ä¿®æ”¹æ¨£å¼ï¼Œæ‡‰è©²åœ¨åŸç‰ˆæ¨¡çµ„ä¸­ä¿®æ”¹ï¼Œautorunner æœƒè‡ªå‹•ç¹¼æ‰¿ã€‚

### å¸¸è¦‹ç¶­è­·äº‹é …

**é…ç½®æ ¼å¼è®Šæ›´ï¼š**
- æ›´æ–° `config_template.json`
- æ›´æ–° `ConfigValidator` çš„é©—è­‰é‚è¼¯
- æ›´æ–°æœ¬ README çš„é…ç½®èªªæ˜

**åŸç‰ˆæ¨¡çµ„ä»‹é¢è®Šæ›´ï¼š**
- æª¢æŸ¥ autorunner çš„èª¿ç”¨é‚è¼¯æ˜¯å¦éœ€è¦æ›´æ–°
- ç¢ºä¿åƒæ•¸è½‰æ›é‚è¼¯ä»ç„¶æ­£ç¢º
- é‹è¡Œå®Œæ•´æ¸¬è©¦ç¢ºèªå…¼å®¹æ€§

**æ–°å¢é…ç½®é¸é …ï¼š**
- åœ¨å°æ‡‰çš„ Runner é¡ä¸­æ·»åŠ è™•ç†é‚è¼¯
- æ›´æ–°é…ç½®æ¨¡æ¿å’Œé©—è­‰å™¨
- æ·»åŠ ä½¿ç”¨ç¯„ä¾‹åˆ°æœ¬ README

---

## ç–‘é›£æ’è§£

### 1. é…ç½®æ–‡ä»¶è¼‰å…¥å¤±æ•— 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** é¸æ“‡é…ç½®æ–‡ä»¶å¾Œé¡¯ç¤ºã€ŒJSON æ ¼å¼éŒ¯èª¤ã€æˆ–ã€Œç·¨ç¢¼éŒ¯èª¤ã€

**å¯èƒ½åŸå› ï¼š**
- JSON æ ¼å¼ä¸æ­£ç¢ºï¼ˆç¼ºå°‘é€—è™Ÿã€æ‹¬è™Ÿä¸åŒ¹é…ç­‰ï¼‰
- æ–‡ä»¶ç·¨ç¢¼ä¸æ˜¯ UTF-8
- æ–‡ä»¶åŒ…å« BOMï¼ˆByte Order Markï¼‰

**è§£æ±ºæ–¹æ³•ï¼š**
- ä½¿ç”¨ JSON validator æª¢æŸ¥æ ¼å¼ï¼ˆå¦‚ [jsonlint.com](https://jsonlint.com/)ï¼‰
- ç¢ºèªæ–‡ä»¶ç·¨ç¢¼ç‚º UTF-8ï¼ˆä¸å« BOMï¼‰
- æª¢æŸ¥æ˜¯å¦æœ‰ä¸­æ–‡å¼•è™Ÿï¼ˆ""ï¼‰æ‡‰æ”¹ç‚ºè‹±æ–‡å¼•è™Ÿï¼ˆ""ï¼‰
- å¾ `templates/` ç›®éŒ„è¤‡è£½æ¨¡æ¿é‡æ–°ç·¨è¼¯

---

### 2. é…ç½®é©—è­‰å¤±æ•— 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** é…ç½®æ–‡ä»¶é©—è­‰æ™‚é¡¯ç¤ºã€Œç¼ºå°‘å¿…è¦æ¬„ä½ã€æˆ–ã€Œåƒæ•¸æ ¼å¼éŒ¯èª¤ã€

**å¯èƒ½åŸå› ï¼š**
- ç¼ºå°‘å¿…è¦çš„é…ç½®å€å¡Šï¼ˆdataloaderã€backtesterï¼‰
- æŒ‡æ¨™åƒæ•¸æ ¼å¼ä¸æ­£ç¢º
- æ•¸æ“šæºé…ç½®ä¸å®Œæ•´

**è§£æ±ºæ–¹æ³•ï¼š**
- å°ç…§ `config_template.json` æª¢æŸ¥æ˜¯å¦ç¼ºå°‘å¿…è¦æ¬„ä½
- ç¢ºèªæŒ‡æ¨™åƒæ•¸ä½¿ç”¨ç¯„åœæ ¼å¼ï¼š`"10:100:10"`ï¼ˆèµ·å§‹:çµæŸ:æ­¥é•·ï¼‰
- ç¢ºèªé¸æ“‡çš„æ•¸æ“šæºæœ‰å°æ‡‰çš„é…ç½®å€å¡Šï¼ˆå¦‚é¸æ“‡ binance éœ€è¦ binance_configï¼‰
- æª¢æŸ¥éŒ¯èª¤ä¿¡æ¯ä¸­æŒ‡å‡ºçš„å…·é«”ç¼ºå¤±æ¬„ä½

---

### 3. Timestamp ç„¡æ³•æ­£ç¢ºè½‰æ› 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** é æ¸¬å› å­åŒ…å« timestampï¼Œä½†è¼‰å…¥å¾Œæ™‚é–“ç¯„åœéŒ¯èª¤æˆ–ç„¡æ³•èˆ‡åƒ¹æ ¼æ•¸æ“šå°é½Š

**å¯èƒ½åŸå› ï¼š**
- `time_format` è¨­å®šéŒ¯èª¤ï¼ˆæ‡‰è©²ç•™ç©ºä½†å¡«äº†æ ¼å¼ï¼‰
- Timestamp æ•¸å€¼è¶…å‡ºåˆç†ç¯„åœ
- Timestamp è¢«è®€å–ç‚ºå­—ç¬¦ä¸²è€Œéæ•¸å€¼

**è§£æ±ºæ–¹æ³•ï¼š**
- **å¦‚æœæ˜¯ Unix timestampï¼ˆç´”æ•¸å­—ï¼‰**ï¼š`"time_format": ""` å¿…é ˆç•™ç©º
- ç¢ºèª timestamp ç¯„åœåˆç†ï¼š
  - ç§’ç´šï¼šç´„ 10 ä½æ•¸ï¼ˆ1000000000 ~ 2000000000ï¼‰
  - æ¯«ç§’ç´šï¼šç´„ 13 ä½æ•¸ï¼ˆ1000000000000 ~ 2000000000000ï¼‰
- æª¢æŸ¥ CSV æ–‡ä»¶ä¸­ timestamp æ¬„ä½æ˜¯å¦æœ‰å¼•è™ŸåŒ…åœï¼ˆæ‡‰è©²æ²’æœ‰ï¼‰
- æŸ¥çœ‹èª¿è©¦ä¿¡æ¯ä¸­çš„ã€Œæª¢æ¸¬ timestampã€é¢æ¿ï¼Œç¢ºèªæ•¸å€¼é¡å‹

---

### 4. æ•¸æ“šè¼‰å…¥å¾Œç„¡æ³•åˆä½µ 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** é¡¯ç¤ºã€Œåƒ¹æ ¼æ•¸æ“šèˆ‡é æ¸¬å› å­æ•¸æ“šç„¡æ™‚é–“äº¤é›†ï¼Œç„¡æ³•åˆä½µã€

**å¯èƒ½åŸå› ï¼š**
- æ™‚é–“ç¯„åœæ²’æœ‰é‡ç–Š
- æ™‚é–“ç²¾åº¦ä¸åŒï¼ˆåƒ¹æ ¼ç²¾ç¢ºåˆ°ç§’ï¼Œé æ¸¬å› å­åªæœ‰æ—¥æœŸï¼‰
- æ™‚å€å•é¡Œ

**è§£æ±ºæ–¹æ³•ï¼š**
- æŸ¥çœ‹ã€Œæ™‚é–“å°é½Šè¨ºæ–·ã€é¢æ¿ï¼Œå°æ¯”å…©é‚Šçš„æ™‚é–“ç¯„åœ
- ç¢ºèªå…©é‚Šçš„æ™‚é–“ç¯„åœæœ‰é‡ç–Š
- å¦‚æœç²¾åº¦ä¸åŒï¼Œéœ€è¦çµ±ä¸€ç²¾åº¦ï¼ˆéƒ½ä½¿ç”¨æ—¥æœŸæˆ–éƒ½ç²¾ç¢ºåˆ°ç§’ï¼‰
- æª¢æŸ¥ timestamp è½‰æ›æ˜¯å¦æˆåŠŸï¼ˆæ‡‰è©²çœ‹åˆ°ã€Œtimestampè½‰æ›æˆåŠŸã€æç¤ºï¼‰

---

### 5. å›æ¸¬ç„¡äº¤æ˜“æˆ–äº¤æ˜“æ•¸é‡ç•°å¸¸ 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** å›æ¸¬å®Œæˆä½†é¡¯ç¤ºã€Œç„¡äº¤æ˜“ã€æˆ–äº¤æ˜“æ•¸é‡èˆ‡é æœŸä¸ç¬¦

**å¯èƒ½åŸå› ï¼š**
- æŒ‡æ¨™åƒæ•¸ç¯„åœä¸åˆç†ï¼ˆå¦‚ MA é€±æœŸéé•·ï¼‰
- ç­–ç•¥æ¢ä»¶é…å°éŒ¯èª¤
- é æ¸¬å› å­æ¬„ä½åç¨±éŒ¯èª¤
- æ•¸æ“šè³ªé‡å•é¡Œï¼ˆç¼ºå¤±å€¼ã€ç•°å¸¸å€¼éå¤šï¼‰

**è§£æ±ºæ–¹æ³•ï¼š**
- æª¢æŸ¥æŒ‡æ¨™åƒæ•¸ç¯„åœæ˜¯å¦åˆç†ï¼ˆMA é€±æœŸä¸æ‡‰è¶…éæ•¸æ“šé•·åº¦çš„1/3ï¼‰
- ç¢ºèª `selected_predictor` æ¬„ä½åç¨±èˆ‡æ•¸æ“šä¸­çš„æ¬„ä½ä¸€è‡´
- æª¢æŸ¥ç­–ç•¥æ¢ä»¶é…å°é‚è¼¯æ˜¯å¦æ­£ç¢º
- å…ˆç”¨è¼ƒå¯¬é¬†çš„åƒæ•¸ç¯„åœæ¸¬è©¦ï¼ˆå¦‚ MA 10:50:10ï¼‰
- æŸ¥çœ‹æ•¸æ“šé è¦½ï¼Œç¢ºèªæ•¸æ“šè³ªé‡æ­£å¸¸

---

### 6. é…ç½®æ–‡ä»¶ä¸­æœ‰å¤šå€‹æ™‚é–“æ¬„ä½ 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** CSV æ–‡ä»¶åŒ…å«å¤šå€‹æ™‚é–“ç›¸é—œæ¬„ä½ï¼ˆå¦‚ `timestamp`ã€`timestamp.1`ã€`Time`ï¼‰ï¼Œå°è‡´è¼‰å…¥å¤±æ•—

**å¯èƒ½åŸå› ï¼š**
- CSV æ–‡ä»¶åŒ¯å‡ºæ™‚ç”¢ç”Ÿé‡è¤‡æ¬„ä½
- Excel è½‰ CSV æ™‚æ¬„ä½åç¨±è¡çª

**è§£æ±ºæ–¹æ³•ï¼š**
- ç³»çµ±æœƒè‡ªå‹•é¸æ“‡å„ªå…ˆé †åºæœ€é«˜çš„æ¬„ä½ï¼ˆtimestamp > datetime > date > time > periodï¼‰
- è‡ªå‹•æ’é™¤å¸¶æœ‰æ•¸å­—å¾Œç¶´çš„é‡è¤‡æ¬„ä½ï¼ˆå¦‚ `timestamp.1`ã€`time_2`ï¼‰
- å¦‚æœä»æœ‰å•é¡Œï¼Œåœ¨ CSV ä¸­æ‰‹å‹•åˆªé™¤é‡è¤‡çš„æ™‚é–“æ¬„ä½ï¼Œåªä¿ç•™ä¸€å€‹
- åœ¨ `predictor_config` ä¸­æ˜ç¢ºæŒ‡å®šè¦ä½¿ç”¨çš„æ™‚é–“æ¬„ä½ï¼š`"time_column": "timestamp"`

---

### 7. ç¸¾æ•ˆåˆ†æå¤±æ•—æˆ–çµæœä¸å®Œæ•´ 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** MetricsRunner åŸ·è¡Œå¤±æ•—æˆ–åˆ†æçµæœç¼ºå¤±æŸäº›æŒ‡æ¨™

**å¯èƒ½åŸå› ï¼š**
- Parquet æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼éŒ¯èª¤
- å›æ¸¬è¨˜éŒ„ç¼ºå°‘å¿…è¦æ¬„ä½
- ç„¡é¢¨éšªåˆ©ç‡æˆ–æ™‚é–“å–®ä½è¨­å®šéŒ¯èª¤

**è§£æ±ºæ–¹æ³•ï¼š**
- ç¢ºèª `records/backtester/` ç›®éŒ„ä¸‹æœ‰ Parquet æ–‡ä»¶
- æª¢æŸ¥ Parquet æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼ˆä½¿ç”¨ `records/Read_parquet.py` æŸ¥çœ‹ï¼‰
- ç¢ºèª `risk_free_rate` æ ¼å¼æ­£ç¢ºï¼ˆ0.04 è¡¨ç¤º 4%ï¼‰
- ç¢ºèª `time_unit` è¨­å®šæ­£ç¢ºï¼ˆæ—¥ç·šè‚¡ç¥¨ 252ï¼Œæ—¥ç·šå¹£ 365ï¼‰
- æŸ¥çœ‹ MetricsRunner çš„éŒ¯èª¤ä¿¡æ¯ï¼Œæ ¹æ“šæç¤ºä¿®æ­£

---

### 8. å¤šé…ç½®åŸ·è¡Œæ™‚éƒ¨åˆ†å¤±æ•— 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** æ‰¹æ¬¡åŸ·è¡Œå¤šå€‹é…ç½®æ™‚ï¼ŒæŸäº›é…ç½®æˆåŠŸï¼ŒæŸäº›å¤±æ•—

**å¯èƒ½åŸå› ï¼š**
- æŸäº›é…ç½®æ–‡ä»¶æ ¼å¼æœ‰èª¤
- æŸäº›æ•¸æ“šæºç„¡æ³•é€£æ¥ï¼ˆå¦‚ API é™åˆ¶ï¼‰
- è³‡æºä¸è¶³ï¼ˆè¨˜æ†¶é«”ã€ç£ç¢Ÿç©ºé–“ï¼‰

**è§£æ±ºæ–¹æ³•ï¼š**
- æŸ¥çœ‹åŸ·è¡Œæ‘˜è¦ï¼Œæ‰¾å‡ºå¤±æ•—çš„é…ç½®æ–‡ä»¶
- å–®ç¨é‹è¡Œå¤±æ•—çš„é…ç½®ï¼ŒæŸ¥çœ‹è©³ç´°éŒ¯èª¤ä¿¡æ¯
- æª¢æŸ¥ç¶²è·¯é€£æ¥ï¼ˆå°æ–¼ API æ•¸æ“šæºï¼‰
- ç¢ºèªæœ‰è¶³å¤ çš„ç£ç¢Ÿç©ºé–“å„²å­˜çµæœ
- è€ƒæ…®åˆ†æ‰¹åŸ·è¡Œï¼Œæ¸›å°‘åŒæ™‚è™•ç†çš„é…ç½®æ•¸é‡

---

### 9. åƒæ•¸çµ„åˆæ•¸é‡ç•°å¸¸ 09/10/2025

**å•é¡Œè©³æƒ…ï¼š** é¡¯ç¤ºçš„åƒæ•¸çµ„åˆæ•¸é‡èˆ‡é æœŸä¸ç¬¦ï¼ˆå¦‚é æœŸ 16 å€‹å»é¡¯ç¤º 80 å€‹ï¼‰

**å¯èƒ½åŸå› ï¼š**
- æŒ‡æ¨™åƒæ•¸è½‰æ›é‚è¼¯éŒ¯èª¤
- ç­–ç•¥é…å°è¤‡è£½éŒ¯èª¤
- åƒæ•¸ç¯„åœè§£æéŒ¯èª¤

**è§£æ±ºæ–¹æ³•ï¼š**
- ç¢ºèªä½¿ç”¨ `BacktestRunner_autorunner.py` çš„ `_convert_indicator_params()` æ–¹æ³•
- æª¢æŸ¥æ¯å€‹æŒ‡æ¨™çš„åƒæ•¸ç¯„åœæ ¼å¼æ˜¯å¦æ­£ç¢º
- ç¢ºèª `condition_pairs` æ•¸é‡èˆ‡é æœŸä¸€è‡´
- æŸ¥çœ‹èª¿è©¦è¼¸å‡ºä¸­çš„ã€Œåƒæ•¸çµ„åˆæ•¸é‡ã€ä¿¡æ¯
- åƒè€ƒ DEV_PLAN.md ä¸­çš„ã€Œåƒæ•¸çµ„åˆæ•¸é‡ç•°å¸¸å•é¡Œã€è§£æ±ºæ–¹æ¡ˆ

---

## èˆ‡å…¶ä»–æ¨¡çµ„çš„é—œè¯

### ä¸Šæ¸¸ä¾è³´

- **main.py**ï¼šæä¾› autorunner å…¥å£
- **é…ç½®æ–‡ä»¶**ï¼šå®šç¾©åŸ·è¡Œåƒæ•¸

### ä¸‹æ¸¸èª¿ç”¨

- **dataloader**ï¼šæ•¸æ“šè¼‰å…¥èˆ‡å‰è™•ç†
- **backtester**ï¼šå›æ¸¬åŸ·è¡Œèˆ‡äº¤æ˜“æ¨¡æ“¬
- **metricstracker**ï¼šç¸¾æ•ˆæŒ‡æ¨™è¨ˆç®—

### æ•¸æ“šå‚³é

```
é…ç½®æ–‡ä»¶ â†’ ConfigLoader â†’ Base_autorunner
                             â†“
                      DataLoader_autorunner â†’ dataloader æ¨¡çµ„
                             â†“
                      BacktestRunner_autorunner â†’ backtester æ¨¡çµ„
                             â†“
                      MetricsRunner_autorunner â†’ metricstracker æ¨¡çµ„
```

---

## é–‹ç™¼è¦ç¯„

### ä»£ç¢¼é¢¨æ ¼

- éµå¾ª PEP 8 è¦ç¯„
- ä½¿ç”¨é¡å‹æç¤ºï¼ˆType Hintsï¼‰
- æ·»åŠ å®Œæ•´çš„ docstring
- ä½¿ç”¨ Rich Panel çµ±ä¸€ UI æ¨£å¼

### èª¿è©¦è¼¸å‡º

- ä½¿ç”¨ Rich Panel è€Œé print()
- èª¿è©¦ä¿¡æ¯ä½¿ç”¨ `console.print()`
- ä¿æŒè¼¸å‡ºæ ¼å¼ä¸€è‡´
- é‡è¦æ­¥é©Ÿæ·»åŠ èª¿è©¦è¼¸å‡º

### éŒ¯èª¤è™•ç†

- ä½¿ç”¨ try-except æ•ç²æ‰€æœ‰å¯èƒ½çš„ç•°å¸¸
- æä¾›è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯å’Œä¿®å¾©å»ºè­°
- ä½¿ç”¨ Rich Panel é¡¯ç¤ºéŒ¯èª¤ï¼ˆç´…è‰²é‚Šæ¡† `#8f1511`ï¼‰
- ä¸è¦è®“ç¨‹åºç›´æ¥å´©æ½°ï¼Œæä¾›å‹å–„çš„éŒ¯èª¤æç¤º

### è¨­è¨ˆåŸå‰‡ï¼ˆé‡è¦ï¼ï¼‰

1. **ä¸é‡è¤‡å¯¦ç¾**ï¼šç›´æ¥èª¿ç”¨åŸç‰ˆæ¨¡çµ„çš„æ–¹æ³•ï¼Œä¸è‡ªå·±å¯«æ–°ä»£ç¢¼
2. **åªè² è²¬è½‰æ›**ï¼šé…ç½®åƒæ•¸ â†’ åŸç‰ˆæ¨¡çµ„åƒæ•¸çš„è½‰æ›
3. **ä¿æŒä¸€è‡´**ï¼šUI æ¨£å¼ã€éŒ¯èª¤è™•ç†èˆ‡åŸç‰ˆæ¨¡çµ„ä¿æŒä¸€è‡´
4. **èª¿ç”¨åŸç‰ˆæ–¹æ³•**ï¼šå¦‚ `self._loader_helper.detect_and_convert_timestamp()`

**ç¯„ä¾‹ï¼š**
```python
# âŒ éŒ¯èª¤ï¼šè‡ªå·±å¯¦ç¾ timestamp è½‰æ›
def _detect_and_convert_timestamp(self, data, time_col):
    # ... 100 è¡Œé‡è¤‡ä»£ç¢¼ ...

# âœ… æ­£ç¢ºï¼šèª¿ç”¨åŸç‰ˆæ–¹æ³•
from dataloader.file_loader import FileLoader
self._loader_helper = FileLoader()
self._loader_helper.detect_and_convert_timestamp(data, time_col)
```

---

## åƒè€ƒè³‡æº

### ç›¸é—œæ–‡ä»¶

- **DEV_PLAN.md** - é–‹ç™¼è¨ˆåŠƒèˆ‡é€²åº¦è¨˜éŒ„
- **dataloader/README.md** - æ•¸æ“šè¼‰å…¥æ¨¡çµ„èªªæ˜
- **backtester/README.md** - å›æ¸¬æ¨¡çµ„èªªæ˜
- **metricstracker/README.md** - ç¸¾æ•ˆåˆ†ææ¨¡çµ„èªªæ˜
- **Development_Guideline.md** - é–‹ç™¼æŒ‡å—
- **README_CLI_STYLE.md** - CLI æ¨£å¼è¦ç¯„

### é…ç½®æ¨¡æ¿

- `records/autorunner/config_template.json` - å®Œæ•´é…ç½®æ¨¡æ¿
- `records/autorunner/config_template_single.json` - ç°¡åŒ–å–®ç­–ç•¥æ¨¡æ¿
- `records/autorunner/config_template_5mdata.json` - 5åˆ†é˜æ•¸æ“šæ¨¡æ¿
- `records/autorunner/config_template_single_timestamp.json` - Timestamp è™•ç†ç¯„ä¾‹

### åŸç‰ˆæ¨¡çµ„

- `dataloader/base_loader.py` - æ•¸æ“šè¼‰å…¥åŸºåº•é¡
- `backtester/Base_backtester.py` - å›æ¸¬ä¸»æ§åˆ¶å™¨
- `metricstracker/Base_metricstracker.py` - ç¸¾æ•ˆåˆ†æä¸»æ§åˆ¶å™¨

---

